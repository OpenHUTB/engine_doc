<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<!-- Mirrored from docs.unrealengine.com/4.26/zh-CN/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 17 Jan 2024 11:10:32 GMT -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../../../../../Include/Javascript/common_zh-CN.js" type="text/javascript"></script>
	<script type="text/javascript">
		var time = new Date(0);
		var preview = false;
		var relativeHTMLPath = "https://docs.unrealengine.com/4.26/";
				var pageid = 0;
				var heroimage = "";
				var finishButton = finishButtonTemplate;
				var lang = "zh-CN";
				var basePath = document.location.pathname.substring(0, document.location.pathname.indexOf('/' + lang + '/') + lang.length + 1);
		document.write('<base href="' +  encodeURI(basePath) + '/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/" />');
				var udnCSS = '../../../../../Include/CSS/udn_public.css';
		var udnLangCSS = '';
				udnLangCSS = './../../../../../Include/CSS/udn_public_CN.css">';
				var udnOverrideCSS = '../../../../../Include/CSS/skin_overrides.css';
		var udnOverrideDarkCSS = '../../../../../Include/CSS/skin_overrides_dark.css';
		var fancyboxCSS = '../../../../../Include/CSS/jquery.fancybox.css';
		var jqueryuiCSS = '../../../../../Include/CSS/jquery-ui.min.css';
		var qtipCSS = '../../../../../Include/CSS/jquery.qtip.css';
		var prettifyCSS = '../../../../../Include/CSS/prettify.css';
		var navbarCSS = '../../../../../Include/CSS/navBar.css';
		var twentytwentyCSS = '../../../../../Include/CSS/twentytwenty.css';
		var recommendationsCSS = '../../../../../Include/CSS/jquery.recommendations.css';
	</script>
    <title>组件和碰撞 | 虚幻引擎文档</title>
    	    <meta name=viewport content="width=device-width, initial-scale=1" />
	<meta http-equiv="Cache-control" content="no-store">
    <script  src="../../../../../Include/Javascript/CustomEvent.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/jquery-3.4.0.min.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/udn.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/udn_extras.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/jquery-ui.min.js" type="text/javascript"></script>
		    <script  src="../../../../../Include/Javascript/informational.js" type="text/javascript"></script>
		    <script  src="../../../../../Include/Javascript/jquery.fancybox.pack.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/jquery.qtip.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/prettify.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/jquery.slimscroll.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/jquery.event.move.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/jquery.twentytwenty.js" type="text/javascript"></script>
    <script  src="../../../../../Include/Javascript/lazysizes.min.js" type="text/javascript"></script>
	    <script  src="../../../../../Include/Javascript/jquery.recommendations.js" type="text/javascript"></script>
	
    <link async rel="icon" href="../../../../../../favicon.png" type="image/x-icon" />
    <link async rel="shortcut icon" href="../../../../../../favicon.png" type="image/x-icon" />
    <link async href="../../../../../Include/Images/touch_icon.png" rel="apple-touch-icon" />
    <link async href="../../../../../Include/Images/touch_icon_114.png" sizes="114x114" rel="apple-touch-icon" />    
		<script  src="../../../../../Include/Javascript/CollapsibleLists.js" type="text/javascript"></script>
	<script  src="../../../../../Include/Javascript/navigationBarUI.js"></script>
	<script  src="../../../../../Include/Javascript/navigationBar.js"></script>
		
	<link rel="alternate" href="https://docs.unrealengine.com/latest/en-US/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/" hreflang="x-default" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/zh-CN/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/" hreflang="zh-CN" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/ja/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/" hreflang="ja" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/ko/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/" hreflang="ko" />

	<meta name="redirect" content="ProgrammingAndScripting/Tutorials/Components" />
<meta name="redirect" content="Programming/Tutorials/Components" />
<meta name="intsourcechangelist" content="15283240" />
<meta name="availability" content="Public" />
<meta name="title" content="组件和碰撞" />
<meta name="description" content="学习利用组件将Pawn与物理交互、使用粒子效果等方法。" />
<meta name="parent" content="ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials" />
<meta name="version" content="4.24" />
<meta name="type" content="how-to" />
<meta name="skilllevel" content="beginner" />
<meta name="keywords" content="quickstart" />
<meta name="keywords" content="programming" />
<meta name="keywords" content="collision" />
<meta name="keywords" content="component" />
<meta name="keywords" content="pawn" />
<meta name="crumbs" content="%ROOT%,ProgrammingAndScripting,ProgrammingAndScripting/ProgrammingWithCPP,ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials" />

	<meta name="twitter:card" content="summary_large_image" />
	<meta property="og:title" content="组件和碰撞" />
	<meta property="og:description" content="学习利用组件将Pawn与物理交互、使用粒子效果等方法。" />
		<meta property="og:image" content="" />
	</head>
<body id="webbgThree" style="visibility: hidden;" onload="document.body.style.visibility='visible';">
			<script>window.__tracking_base = 'https://tracking.unrealengine.com/';</script>
	<script src="../../../../../../../tracking.unrealengine.com/tracking.js" async></script>    <div id="webThree">
				<div id="page_head">
						<script type="module" 
					crossorigin="anonymous" 
					src="https://components.unrealengine.com/navigation/edc-navigation.mjs"></script>
			<edc-navigation blackListLangCodes='["de-de","es-es","es-mx","fr-fr","it-it","pt-br","ru-ru","pl-pl","tr-tr"]' locale="zh-CN" ></edc-navigation>
						<div id="pagenav">
				<div class="crumbs" id="crumbs">
<span id="versionContainer">
	<span id="versionSelect" class="btn btn-version" onclick="ToggleMenu($('#versionMenu'), $(this));"></span>
	<div id="versionMenu">
		<div id="4_26" data-version="4.26" class="btn btn-select" onclick="createCookie('version', '4.26', 365);SwitchVersion('4.26');">Unreal Engine 4.26 Documentation</div>
		<div id="4_27" data-version="4.27" class="btn btn-select" onclick="createCookie('version', '4.27', 365);SwitchVersion('4.27');">Unreal Engine 4.27 Documentation</div>
		<div id="5_0" data-version="5.0" class="btn btn-select" onclick="createCookie('version', '5.0', 365);SwitchVersion('5.0');">Unreal Engine 5.0 Documentation</div>
		<div id="5_1" data-version="5.1" class="btn btn-select" onclick="createCookie('version', '5.1', 365);SwitchVersion('5.1');">Unreal Engine 5.1 Documentation</div>
		<div id="5_2" data-version="5.2" class="btn btn-select" onclick="createCookie('version', '5.2', 365);SwitchVersion('5.2');">Unreal Engine 5.2 Documentation</div>
		<div id="5_3" data-version="5.3" class="btn btn-select" onclick="createCookie('version', '5.3', 365);SwitchVersion('5.3');">Unreal Engine 5.3 Documentation</div>
	</div>
</span>
	<span class="separator">></span> <a id="parent_link" href="../../../index.html">编程和脚本编写</a>

	<span class="separator">></span> <a id="parent_link" href="../../index.html">编程指南</a>

	<span class="separator">></span> <a id="parent_link" href="../index.html">C++ 编程教程</a>

<span class="separator">></span> <span id="page">组件和碰撞</span>
</div>				<div id="pageNavRight">
								<!-- Start of Search -->
												<div id="search_container">
					<form name="bodySearch" method="get" action="https://www.unrealengine.com/zh-CN/bing-search" onsubmit="return validateSearch()">
						<input type="image" src="../../../../../Include/Images/search_box_icon.png" class="searchbutton"/>
						<input type="hidden" name="filter" value="文档" />
						<input type="text" name="keyword" placeholder="搜索文档……" class="searchbox" autocomplete="off"/>
					</form>
				</div>
								<!-- End of Search -->
				<div id="skinContainer">
	<div id="skinSelect" class="btn btn-skin" onclick="ToggleMenu($('#skinMenu'), $(this));"></div>
	<div id="skinMenu">
		<div id="light" class="btn btn-select" onclick="createCookie('skin', 'light', 365);location.reload();">Light Theme</div>
		<div id="dark" class="btn btn-select" onclick="createCookie('skin', 'dark', 365);location.reload();">Dark Theme</div>
	</div>
</div>				</div>
			</div>
		</div>						<div id="navWrapper">
			<div id="nav-filter-container">
				<div id="nav-filter-inner">
					<form>
						<input type="text" placeholder="Filter pages..." id="nav-filter" onchange="clearTimeout(filterTimer); filterTimer = setTimeout(updateNavTreeFilter,250, this.value);if(this.value.length == 0){$('#filter-clear').hide();}else{$('#filter-clear').show();}" onkeypress="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" />
						<button class="close-icon" id="filter-clear" type="reset" onclick="clearTimeout(filterTimer); filterTimer = setTimeout(updateNavTreeFilter,250, '');$(this).hide();"></button>
					</form>
				</div>
			</div>
			<nav id="navPanel">
			</nav>
			<div id="navigation" title="Click to toggle navigation menu"><span>></span></div>
		</div>		
		<div id="splitter">
		</div>
				<div id="contentContainer">
										<div id="pagedefault">
				<div id="product-banner">
	<div id="product-logo"></div>
</div>				<div id="pagecontainer" style="padding-right:0px;">
					<!-- Start of Markdown converted page content -->
																				<div class="hero  ">
						<div class="imgContainer"><img src="#" /></div>						<div class="info">
							<div id="pageTitle">
								<h1 id="H1TitleId">组件和碰撞</h1>
							</div>	
							<h2 >学习利用组件将Pawn与物理交互、使用粒子效果等方法。</h2>
							<div id="access">
								<div class="accessContainer">
																		<div class="skill_tag_filter Beginner"><a id="skill_link" href="../../../../SiteIndex/index.html?skills=Beginner">Beginner</a></div>
																	</div>
							</div>
						</div>
					</div>
																				<div id="maincol">
						<div class="togglesection" id="osContainer">
	<div class="normaltitle">
		<p>Choose your operating system:</p>
	</div><div class="toggleButtons">
		<div class="btn btn-default btn-toggle OS windows" id="windows" onclick="setSelector('OS', 'windows');">
			<p>Windows</p>
		</div>
		<div class="btn btn-default btn-toggle OS mac" id="mac" onclick="setSelector('OS', 'mac');">
			<p>macOS</p>
		</div>
		<div class="btn btn-default btn-toggle OS linux" id="linux" onclick="setSelector('OS', 'linux');">
			<p>Linux</p>
		</div>
	</div>
</div>																																																<div class="toc">
<div style="position:relative;">
    <div class="title">
    本页面的内容
    </div>
<div id="tocScroll">
    <ul>
	    		    			    <li id="">
	<p><a id="toc_link" href="#1.创建和附加组件">1.创建和附加组件</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#半成品代码">半成品代码</a></p>
	</li>					</ul>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#2.配置输入和创建pawn移动组件">2.配置输入和创建Pawn移动组件</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#3.为pawn移动组件的行为编写代码">3.为Pawn移动组件的行为编写代码</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#半成品代码_1">半成品代码</a></p>
	</li>					</ul>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#4.同时使用pawn和组件">4.同时使用Pawn和组件</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#最终代码">最终代码</a></p>
	</li>					</ul>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#5.在编辑器中运行">5.在编辑器中运行</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#6.自行尝试！">6.自行尝试！</a></p>
	</li>		    	        </ul>
</div>
</div>
</div>
<p>本教程将讲解创建 <strong>组件（Components）</strong>、将其放进层级、在Gameplay中控制它们，以及在包含固体对象的场景中移动 <strong>Pawn</strong> 的方法。
</p><!--
videoid:paramliteral
width:paramliteral
height:paramliteral
units:paramliteral
type:paramliteral
start:paramliteral
service:paramliteral
-->
<style type="text/css">
#player_1_r4vli06i_7
{
	margin: 0px;
	width: 75%;
	display: inline-block;
	position: relative;
	overflow: hidden;
}
#player_1_r4vli06i_7:after
{
	content: "";
	padding-top: 56.25%;
	display: block;
}
</style> 
<div id="player_1_r4vli06i_7"> 
	<div id="playerContainer_1_r4vli06i_7" style="position:absolute;top:0;left: 0;right: 0;bottom:0;border:solid thin black;">
		<iframe width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media;" allowfullscreen="" src="https://dev.epicgames.com/community/api/cms/videos/1_r4vli06i/embed.html"></iframe>
	</div>
</div>
<h2 id="1.创建和附加组件">1.创建和附加组件</h2>
<p><strong>虚幻引擎4</strong>（UE4），建议先阅读<a id="content_link"filter-data="tag_programming tag_c++" href="../../CPPProgrammingQuickStart/index.html" ><span>编程快速入门 tutorial</span></a>。本教程中将假设已熟悉创建项目和向其添加C++代码，及在虚幻编辑器中配置输入。如对创建Pawn类或配置输入不太熟悉，建议先学习<a id="content_link" href="../PlayerInput/index.html" ><span>玩家输入和Pawn tutorial</span></a></p><ol ><li class="Default"><p>首先使用初学者内容包新建一个C++项目，将其命名为 <code>HowTo&#95;Components</code>。需向此项目添加的首个项目是自定义Pawn，其将包含组件，在关卡中移动并与固体对象碰撞。本教程中将之命名为 <code>CollidingPawn</code>。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ChooseParentClass.jpg">
		<img class="  lazyload" alt="ChooseParentClass.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ChooseParentClass.jpg" />
</picture>

</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/NamePawnClass.jpg">
		<img class="  lazyload" alt="NamePawnClass.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/NamePawnClass.jpg" />
</picture>

</p></li><li class="Default"><p>在你的代码编辑器中（通常为 <strong>Visual Studio</strong> 或 <strong>Xcode</strong>），打开 <code>CollidingPawn.h</code>，然后在类的声明部分的底部添加以下代码：
</p><pre class="prettyprint"><code>UPROPERTY()
class UParticleSystemComponent&#42; OurParticleSystem;</code></pre>
<p>使用此变量追踪之后将创建的 <strong>粒子系统组件</strong>。可直接创建组件而无需设置追踪组件的变量，但要在代码中使用此类组件，应将其储存在类似的类成员变量中。
</p></li><li class="Default"><p>现在可打开CollidingPawn.cpp并编辑构造函数 <strong>ACollidingPawn::ACollidingPawn</strong>，添加将生成各种有用组件并将以层级进行安排的代码。将创建与物理场景交互的 <strong>球体组件</strong>、视觉显示碰撞形态的 <strong>静态网格体组件</strong>、可随意开关的粒子系统组件，及可用于附加 <strong>摄像机组件</strong> 控制游戏视角的 <strong>弹簧臂组件</strong>。在此之前，我们应该添加最终会用到的头文件。在头文件信息所在行的下方，我们要加入：</p><pre class="prettyprint"><code>#include "UObject/ConstructorHelpers.h"
#include "Particles/ParticleSystemComponent.h"
#include "Components/SphereComponent.h"
#include "Camera/CameraComponent.h"
#include "GameFramework/SpringArmComponent.h"</code></pre></li><li class="Default"><p>决定用作层级根节点的组件。球体组件是一种可与游戏场景交互并碰撞的物理实体，本教程将使用球体组件。注意：<strong>Actor</strong> 的层级中可拥有多个启用物理的组件，但本教程中只需要一个。</p><pre class="prettyprint"><code>    // 根组件将成为对物理反应的球体
    USphereComponent&#42; SphereComponent = CreateDefaultSubobject&lt;USphereComponent&gt;(TEXT("RootComponent"));
    RootComponent = SphereComponent;
    SphereComponent-&gt;InitSphereRadius(40.0f);
    SphereComponent-&gt;SetCollisionProfileName(TEXT("Pawn"));</code></pre></li><li class="Default"><p>接下来，将从 <strong>静态网格体</strong> 资源创建并附加半径为50的可见球体。其与刚才创建的半径40的球体组件无法完全吻合，因此需将把其缩小80%。还需将其向下移动40单位，使其中心与球体组件的中心对齐。</p><pre class="prettyprint"><code>    // 创建并放置网格体组件，以便查看球体位置
    UStaticMeshComponent&#42; SphereVisual = CreateDefaultSubobject&lt;UStaticMeshComponent&gt;(TEXT("VisualRepresentation"));
    SphereVisual-&gt;SetupAttachment(RootComponent);
    static ConstructorHelpers::FObjectFinder&lt;UStaticMesh&gt; SphereVisualAsset(TEXT("/Game/StarterContent/Shapes/Shape&#95;Sphere.Shape&#95;Sphere"));
    if (SphereVisualAsset.Succeeded())
    {
        SphereVisual-&gt;SetStaticMesh(SphereVisualAsset.Object);
        SphereVisual-&gt;SetRelativeLocation(FVector(0.0f, 0.0f, -40.0f));
        SphereVisual-&gt;SetWorldScale3D(FVector(0.8f));
    }</code></pre>
<div class="note">
	<p>基于硬编码的资产路径一般不太推荐，例如这个示例中的球体静态网格体的路径；我们通常会在构造函数中创建组件，让它可编辑，然后在虚幻编辑器中创建一个蓝图资产并且在那里设置静态网格体资产。但你也可以直接在代码中这样操作，对于程序员而言，这样还能让调试或者开发新功能变得更快。</p>
</div></li><li class="Default"><p>现可将非活跃粒子系统组件附加到层级。可在代码中操纵此组件，然后设置输入进行开关。注意：粒子系统组件直接附加到静态网格体组件，而非附加到根。其同时略微偏离网格体底部中心，以便在运行时清晰显示。</p><pre class="prettyprint"><code>    // 创建可激活或停止的粒子系统
    OurParticleSystem = CreateDefaultSubobject&lt;UParticleSystemComponent&gt;(TEXT("MovementParticles"));
    OurParticleSystem-&gt;SetupAttachment(SphereVisual);
    OurParticleSystem-&gt;bAutoActivate = false;
    OurParticleSystem-&gt;SetRelativeLocation(FVector(-20.0f, 0.0f, 20.0f));
    static ConstructorHelpers::FObjectFinder&lt;UParticleSystem&gt; ParticleAsset(TEXT("/Game/StarterContent/Particles/P&#95;Fire.P&#95;Fire"));
    if (ParticleAsset.Succeeded())
    {
        OurParticleSystem-&gt;SetTemplate(ParticleAsset.Object);
    }</code></pre></li><li class="Default"><p>利用弹簧臂组件，可将摄像机以低于其追踪Pawn的速度加速和减速，从而获得更平滑的摄像机附加点。其同时拥有内置功能，可防止摄像机穿过固体对象，用于处理如玩家在第三人称游戏里退到角落时等情况。虽然弹簧臂组件并非必要的组件，但它能够轻松让摄像机在游戏中移动时变得更加平滑。</p><pre class="prettyprint"><code>    // 使用弹簧臂给予摄像机平滑自然的运动感。
    USpringArmComponent&#42; SpringArm = CreateDefaultSubobject&lt;USpringArmComponent&gt;(TEXT("CameraAttachmentArm"));
    SpringArm-&gt;SetupAttachment(RootComponent);
    SpringArm-&gt;SetRelativeRotation(FRotator(-45.f, 0.f, 0.f));
    SpringArm-&gt;TargetArmLength = 400.0f;
    SpringArm-&gt;bEnableCameraLag = true;
    SpringArm-&gt;CameraLagSpeed = 3.0f;</code></pre></li><li class="Default"><p>摄像机组件的创建十分容易，在这个示例中，你无需进行任何特殊设置。弹簧臂内置一个特殊的插槽，可供我们添加对象，这样就不必将对象直接添加到组件的根节点上。</p><pre class="prettyprint"><code>    // 创建摄像机并附加到弹簧臂
    UCameraComponent&#42; Camera = CreateDefaultSubobject&lt;UCameraComponent&gt;(TEXT("ActualCamera"));
    Camera-&gt;SetupAttachment(SpringArm, USpringArmComponent::SocketName);</code></pre></li><li class="Default"><p>组件已创建并附加，现在应将此Pawn设为受默认玩家控制。只需下列代码即可：</p><pre class="prettyprint"><code>    // 控制默认玩家
    AutoPossessPlayer = EAutoReceiveInput::Player0;</code></pre></li></ol><p>新Pawn已附加一系列有用组件，可开始用户控制配置。现在回到虚幻编辑器。
</p><h3 id="半成品代码">半成品代码</h3>
<p><strong>CollidingPawn.h</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/Pawn.h"
#include "CollidingPawn.generated.h"

UCLASS()
class HOWTO&#95;COMPONENTS&#95;API ACollidingPawn : public APawn
{
    GENERATED&#95;BODY()

public:
    // 设置此Pawn属性的默认值
    ACollidingPawn();

protected:
    // 游戏开始或生成时调用
    virtual void BeginPlay() override;

public:
    // 逐帧调用
    virtual void Tick( float DeltaSeconds ) override;

    // 调用以将功能与输入绑定
    virtual void SetupPlayerInputComponent(class UInputComponent&#42; InInputComponent) override;

    UPROPERTY()
    class UParticleSystemComponent&#42; OurParticleSystem;
};</code></pre>
<p><strong>CollidingPawn.cpp</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#include "CollidingPawn.h"
#include "UObject/ConstructorHelpers.h"
#include "Particles/ParticleSystemComponent.h"
#include "Components/SphereComponent.h"
#include "Camera/CameraComponent.h"
#include "GameFramework/SpringArmComponent.h"

// 设置默认值
ACollidingPawn::ACollidingPawn()
{
    // 设置该Pawn以逐帧调用Tick()。如无需此功能，可关闭以提高性能。
    PrimaryActorTick.bCanEverTick = true;

    // 根组件将成为对物理反应的球体
    USphereComponent&#42; SphereComponent = CreateDefaultSubobject&lt;USphereComponent&gt;(TEXT("RootComponent"));
    RootComponent = SphereComponent;
    SphereComponent-&gt;InitSphereRadius(40.0f);
    SphereComponent-&gt;SetCollisionProfileName(TEXT("Pawn"));

    // 创建并放置网格体组件，以便查看球体位置
    UStaticMeshComponent&#42; SphereVisual = CreateDefaultSubobject&lt;UStaticMeshComponent&gt;(TEXT("VisualRepresentation"));
    SphereVisual-&gt;SetupAttachment(RootComponent);
    static ConstructorHelpers::FObjectFinder&lt;UStaticMesh&gt; SphereVisualAsset(TEXT("/Game/StarterContent/Shapes/Shape&#95;Sphere.Shape&#95;Sphere"));
    if (SphereVisualAsset.Succeeded())
    {
        SphereVisual-&gt;SetStaticMesh(SphereVisualAsset.Object);
        SphereVisual-&gt;SetRelativeLocation(FVector(0.0f, 0.0f, -40.0f));
        SphereVisual-&gt;SetWorldScale3D(FVector(0.8f));
    }

    // 创建可激活或停止的粒子系统
    OurParticleSystem = CreateDefaultSubobject&lt;UParticleSystemComponent&gt;(TEXT("MovementParticles"));
    OurParticleSystem-&gt;SetupAttachment(SphereVisual);
    OurParticleSystem-&gt;bAutoActivate = false;
    OurParticleSystem-&gt;SetRelativeLocation(FVector(-20.0f, 0.0f, 20.0f));
    static ConstructorHelpers::FObjectFinder&lt;UParticleSystem&gt; ParticleAsset(TEXT("/Game/StarterContent/Particles/P&#95;Fire.P&#95;Fire"));
    if (ParticleAsset.Succeeded())
    {
        OurParticleSystem-&gt;SetTemplate(ParticleAsset.Object);
    }

    // 使用弹簧臂给予摄像机平滑自然的运动感。
    USpringArmComponent&#42; SpringArm = CreateDefaultSubobject&lt;USpringArmComponent&gt;(TEXT("CameraAttachmentArm"));
    SpringArm-&gt;SetupAttachment(RootComponent);
    SpringArm-&gt;SetRelativeRotation(FRotator(-45.f, 0.f, 0.f));
    SpringArm-&gt;TargetArmLength = 400.0f;
    SpringArm-&gt;bEnableCameraLag = true;
    SpringArm-&gt;CameraLagSpeed = 3.0f;

    // 创建摄像机并附加到弹簧臂
    UCameraComponent&#42; Camera = CreateDefaultSubobject&lt;UCameraComponent&gt;(TEXT("ActualCamera"));
    Camera-&gt;SetupAttachment(SpringArm, USpringArmComponent::SocketName);

    // 控制默认玩家
    AutoPossessPlayer = EAutoReceiveInput::Player0;
}

// 游戏开始或生成时调用
void ACollidingPawn::BeginPlay()
{
    Super::BeginPlay();

}

// 逐帧调用
void ACollidingPawn::Tick( float DeltaTime )
{
    Super::Tick( DeltaTime );

}

// 调用以将功能与输入绑定
void ACollidingPawn::SetupPlayerInputComponent(class UInputComponent&#42; InputComponent)
{
    Super::SetupPlayerInputComponent(InInputComponent);
}</code></pre>
<h2 id="2.配置输入和创建pawn移动组件">2.配置输入和创建Pawn移动组件</h2>
<ol ><li class="Default"><p>回到 <strong>虚幻编辑器</strong>，开始配置项目输入设置。可在 <strong>编辑</strong> 下拉菜单中的 <strong>项目设置</strong> 下找到相关设置。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/EditProjectSettings.jpg">
		<img class="  lazyload" alt="EditProjectSettings.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/EditProjectSettings.jpg" />
</picture>

</p><p>进入该菜单后，可在左侧面板中的 <strong>引擎</strong> 部分中选择 <strong>输入</strong>。同时需要设置粒子系统切换的 <strong>操作映射</strong> 、移动 <strong>Pawn</strong> 的两个 <strong>轴映射</strong>，和转动 <strong>Pawn</strong> 的一个 <strong>轴映射</strong>。
</p><table >
	<caption></caption>
	<col align=""/>
	<col align=""/>
	<col align=""/>
	<thead>
			</thead>
<tbody>
	<tr >

	<td rowspan="1" colspan="1" align="">
			<p>操作映射</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			
			</td>
	
	<td rowspan="1" colspan="1" align="">
			
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p>ParticleToggle</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>空格</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			
			</td>
	
</tr></tbody>
</table><table >
	<caption></caption>
	<col align=""/>
	<col align=""/>
	<col align=""/>
	<thead>
			</thead>
<tbody>
	<tr >

	<td rowspan="1" colspan="1" align="">
			<p>轴映射</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			
			</td>
	
	<td rowspan="1" colspan="1" align="">
			
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p>MoveForward</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>W</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>1.0</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>S</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>-1.0</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p>MoveRight</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>A</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>-1.0</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>D</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>1.0</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p>Turn</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>Mouse X</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>1.0</p>
			</td>
	
</tr></tbody>
</table><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/InputSettings.jpg">
		<img class="  lazyload" alt="InputSettings.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/InputSettings.jpg" />
</picture>

</p></li><li class="Default"><p>将创建 <strong>移动组件</strong> 管理移动，而非直接在Pawn类中处理所有移动。本教程中将扩展 <strong>Pawn移动组件</strong> 类。首先在 <strong>文件</strong> 下拉菜单中选择 <strong>将代码添加到项目（Add Code to Project）</strong> 命令。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/AddCPPCode.jpg">
		<img class="  lazyload" alt="AddCPPCode.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/AddCPPCode.jpg" />
</picture>

</p><p>与Pawn类不同的，Pawn移动组件类默认为不可见。要找到该组件，需选中 <strong>显示所有类（Show All Classes）</strong> 选项。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ShowAllClasses.jpg">
		<img class="  lazyload" alt="ShowAllClasses.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ShowAllClasses.jpg" />
</picture>

</p><p>在搜索栏中输入"movement"，以便快速缩小列表范围。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ChooseParentClass2.jpg">
		<img class="  lazyload" alt="ChooseParentClass2.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ChooseParentClass2.jpg" />
</picture>

</p><p><div class="tip">
	<p>Pawn移动组件拥有部分强大内置功能，以便使用常见物理功能，同时便于在大量Pawn类型间共享移动代码。使用组件分隔不同功能是上佳方法，可在项目增大、Pawn越加复杂时减少杂乱。</p>
</div>
</p><p>由于已将Pawn类命名为 <code>CollidingPawn</code>，则将该类命名为 <code>CollidingPawnMovementComponent</code>。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/NameComponent.jpg">
		<img class="  lazyload" alt="NameComponent.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/NameComponent.jpg" />
</picture>

</p></li></ol><p>刚才已对输入配置进行了定义，并创建了自定义Pawn移动组件。现在让我们回到代码编辑器，继续编写代码，定义Pawn移动组件使用时Pawn的移动方式。
</p><h2 id="3.为pawn移动组件的行为编写代码">3.为Pawn移动组件的行为编写代码</h2>
<ol ><li class="Default"><p>现在回到代码编辑器中，为自定义Pawn移动组件编写代码。只需编写 <code>TickComponent</code> 函数（类似Actor的 <code>Tick</code> 函数）告知逐帧移动方式。在 <code>CollidingPawnMovementComponent.h</code> 中，需在类定义中覆盖 <code>TickComponent</code>：
</p><pre class="prettyprint"><code>public:
    virtual void TickComponent(float DeltaTime, enum ELevelTick TickType, FActorComponentTickFunction &#42;ThisTickFunction) override;  </code></pre>
<p>在 <code>CollidingPawnMovementComponent.cpp</code> 中定义此函数：
</p><pre class="prettyprint"><code>void UCollidingPawnMovementComponent::TickComponent(float DeltaTime, enum ELevelTick TickType, FActorComponentTickFunction &#42;ThisTickFunction)
{
    Super::TickComponent(DeltaTime, TickType, ThisTickFunction);

    // 确保所有事物持续有效，以便进行移动。
    if (!PawnOwner &#124;&#124; !UpdatedComponent &#124;&#124; ShouldSkipUpdate(DeltaTime))
    {
        return;
    }

    // 获取（然后清除）ACollidingPawn::Tick中设置的移动向量
    FVector DesiredMovementThisFrame = ConsumeInputVector().GetClampedToMaxSize(1.0f) &#42; DeltaTime &#42; 150.0f;
    if (!DesiredMovementThisFrame.IsNearlyZero())
    {
        FHitResult Hit;
        SafeMoveUpdatedComponent(DesiredMovementThisFrame, UpdatedComponent-&gt;GetComponentRotation(), true, Hit);

        // 若发生碰撞，尝试滑过去
        if (Hit.IsValidBlockingHit())
        {
            SlideAlongSurface(DesiredMovementThisFrame, 1.f - Hit.Time, Hit.Normal, Hit);
        }
    }
};</code></pre>
<p>该代码将在场景中平滑移动Pawn，适当时在表面滑动。未对Pawn应用重力，其最大速度被硬编码为每秒150 <strong>虚幻单位</strong>。
</p><div class="note">
	<p>此 <code>TickComponent</code> 函数使用 <code>UPawnMovementComponent</code> 类提供的几种强大功能。
</p><ul ><li class="Default"><p><code>ConsumeInputVector</code> 报告并清空用于存储移动输入的内置变量值。
</p></li><li class="Default"><p><code>SafeMoveUpdatedComponent</code> 利用虚幻引擎物理移动Pawn移动组件，同时考虑固体障碍。
</p></li><li class="Default"><p>移动导致碰撞时， <code>SlideAlongSurface</code> 会处理沿墙壁和斜坡等碰撞表面平滑滑动所涉及的计算和物理，而非直接停留原地，粘在墙壁或斜坡上。
</p></li></ul><p>Pawn移动组件中还包含众多值得探究的功能，但本教程范围中暂时无需使用。可查看如 <strong>浮动Pawn移动</strong>、<strong>旁观者Pawn移动</strong> 或 **角色移动组件**等其他类，了解额外使用范例和方法。</p>
</div></li></ol><p>定义Pawn移动组件的行为后，可编写代码将其全部关联。
</p><h3 id="半成品代码_1">半成品代码</h3>
<p><strong>CollidingPawn.h</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/Pawn.h"
#include "CollidingPawn.generated.h"

UCLASS()
class HOWTO&#95;COMPONENTS&#95;API ACollidingPawn : public APawn
{
    GENERATED&#95;BODY()

public:
    // 设置此Pawn属性的默认值
    ACollidingPawn();

protected:
    // 游戏开始或生成时调用
    virtual void BeginPlay() override;

public:
    // 逐帧调用
    virtual void Tick( float DeltaSeconds ) override;

    // 调用以将功能与输入绑定
    virtual void SetupPlayerInputComponent(class UInputComponent&#42; InInputComponent) override;

    UPROPERTY()
    class UParticleSystemComponent&#42; OurParticleSystem;
};</code></pre>
<p><strong>CollidingPawn.cpp</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#include "CollidingPawn.h"
#include "UObject/ConstructorHelpers.h"
#include "Particles/ParticleSystemComponent.h"
#include "Components/SphereComponent.h"
#include "Camera/CameraComponent.h"
#include "GameFramework/SpringArmComponent.h"

// 设置默认值
ACollidingPawn::ACollidingPawn()
{
    // 设置该Pawn以逐帧调用Tick()。如无需此功能，可关闭以提高性能。
    PrimaryActorTick.bCanEverTick = true;

    // 根组件将成为对物理反应的球体
    USphereComponent&#42; SphereComponent = CreateDefaultSubobject&lt;USphereComponent&gt;(TEXT("RootComponent"));
    RootComponent = SphereComponent;
    SphereComponent-&gt;InitSphereRadius(40.0f);
    SphereComponent-&gt;SetCollisionProfileName(TEXT("Pawn"));

    // 创建并放置网格体组件，以便查看球体位置
    UStaticMeshComponent&#42; SphereVisual = CreateDefaultSubobject&lt;UStaticMeshComponent&gt;(TEXT("VisualRepresentation"));
    SphereVisual-&gt;SetupAttachment(RootComponent);
    static ConstructorHelpers::FObjectFinder&lt;UStaticMesh&gt; SphereVisualAsset(TEXT("/Game/StarterContent/Shapes/Shape&#95;Sphere.Shape&#95;Sphere"));
    if (SphereVisualAsset.Succeeded())
    {
        SphereVisual-&gt;SetStaticMesh(SphereVisualAsset.Object);
        SphereVisual-&gt;SetRelativeLocation(FVector(0.0f, 0.0f, -40.0f));
        SphereVisual-&gt;SetWorldScale3D(FVector(0.8f));
    }

    // 创建可激活或停止的粒子系统
    OurParticleSystem = CreateDefaultSubobject&lt;UParticleSystemComponent&gt;(TEXT("MovementParticles"));
    OurParticleSystem-&gt;SetupAttachment(SphereVisual);
    OurParticleSystem-&gt;bAutoActivate = false;
    OurParticleSystem-&gt;SetRelativeLocation(FVector(-20.0f, 0.0f, 20.0f));
    static ConstructorHelpers::FObjectFinder&lt;UParticleSystem&gt; ParticleAsset(TEXT("/Game/StarterContent/Particles/P&#95;Fire.P&#95;Fire"));
    if (ParticleAsset.Succeeded())
    {
        OurParticleSystem-&gt;SetTemplate(ParticleAsset.Object);
    }

    // 使用弹簧臂给予摄像机平滑自然的运动感。
    USpringArmComponent&#42; SpringArm = CreateDefaultSubobject&lt;USpringArmComponent&gt;(TEXT("CameraAttachmentArm"));
    SpringArm-&gt;SetupAttachment(RootComponent);
    SpringArm-&gt;SetRelativeRotation(FRotator(-45.f, 0.f, 0.f));
    SpringArm-&gt;TargetArmLength = 400.0f;
    SpringArm-&gt;bEnableCameraLag = true;
    SpringArm-&gt;CameraLagSpeed = 3.0f;

    // 创建摄像机并附加到弹簧臂
    UCameraComponent&#42; Camera = CreateDefaultSubobject&lt;UCameraComponent&gt;(TEXT("ActualCamera"));
    Camera-&gt;SetupAttachment(SpringArm, USpringArmComponent::SocketName);

    // 控制默认玩家
    AutoPossessPlayer = EAutoReceiveInput::Player0;
}

// 游戏开始或生成时调用
void ACollidingPawn::BeginPlay()
{
    Super::BeginPlay();

}

// 逐帧调用
void ACollidingPawn::Tick( float DeltaTime )
{
    Super::Tick( DeltaTime );

}

// 调用以将功能与输入绑定
void ACollidingPawn::SetupPlayerInputComponent(class UInputComponent&#42; InInputComponent)
{
    Super::SetupPlayerInputComponent(InInputComponent);
}</code></pre>
<p><strong>CollidingPawnMovementComponent.h</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/PawnMovementComponent.h"
#include "CollidingPawnMovementComponent.generated.h"

/&#42;&#42;
    &#42; 
    &#42;/
UCLASS()
class HOWTO&#95;COMPONENTS&#95;API UCollidingPawnMovementComponent : public UPawnMovementComponent
{
    GENERATED&#95;BODY()

public:
    virtual void TickComponent(float DeltaTime, enum ELevelTick TickType, FActorComponentTickFunction &#42;ThisTickFunction) override;  
};</code></pre>
<p><strong>CollidingPawnMovementComponent.cpp</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#include "CollidingPawnMovementComponent.h"

void UCollidingPawnMovementComponent::TickComponent(float DeltaTime, enum ELevelTick TickType, FActorComponentTickFunction &#42;ThisTickFunction)
{
    Super::TickComponent(DeltaTime, TickType, ThisTickFunction);

    // 确保所有事物持续有效，以便进行移动。
    if (!PawnOwner &#124;&#124; !UpdatedComponent &#124;&#124; ShouldSkipUpdate(DeltaTime))
    {
        return;
    }

    // 获取（然后清除）ACollidingPawn::Tick中设置的移动向量
    FVector DesiredMovementThisFrame = ConsumeInputVector().GetClampedToMaxSize(1.0f) &#42; DeltaTime &#42; 150.0f;
    if (!DesiredMovementThisFrame.IsNearlyZero())
    {
        FHitResult Hit;
        SafeMoveUpdatedComponent(DesiredMovementThisFrame, UpdatedComponent-&gt;GetComponentRotation(), true, Hit);

        // 若发生碰撞，尝试滑过去
        if (Hit.IsValidBlockingHit())
        {
            SlideAlongSurface(DesiredMovementThisFrame, 1.f - Hit.Time, Hit.Normal, Hit);
        }
    }
};</code></pre>
<h2 id="4.同时使用pawn和组件">4.同时使用Pawn和组件</h2>
<ol ><li class="Default"><p>要使用自定义 <strong>Pawn移动组件</strong>，首先需将变量添加到 <strong>Pawn</strong> 类进行追踪。在CollidingPawn.h中的类定义底部，添加"OurParticleSystem"变量的位置旁，添加：
</p><pre class="prettyprint"><code>UPROPERTY()
class UCollidingPawnMovementComponent&#42; OurMovementComponent;</code></pre></li><li class="Default"><p>拥有可用于追踪其的位置后，需创建存储在新变量中的 <strong>碰撞Pawn移动组件</strong>。因此打开 <code>CollidingPawn.cpp</code> ，在文件顶部 <code>GameFramework/Pawn.h</code> 所在一行的下方添加下列行，以便代码引用新类：
</p><pre class="prettyprint"><code>#include "CollidingPawnMovementComponent.h"</code></pre>
<div class="warning">
	<p>请确保列最后一个头文件是 "generated.h"，否则会造成编译错误。</p>
</div><p>创建Pawn移动组件并将其与Pawn关联的方法非常简单。在 <code>ACollidingPawn::ACollidingPawn</code> 底部，添加此代码：
</p><pre class="prettyprint"><code>// 创建移动组件的实例，并要求其更新根。
OurMovementComponent = CreateDefaultSubobject&lt;UCollidingPawnMovementComponent&gt;(TEXT("CustomMovementComponent"));
OurMovementComponent-&gt;UpdatedComponent = RootComponent;</code></pre>
<p><strong>组件</strong> 不同，无需将此组件附加到自己的组件层级。这是因为其他组件均属于 <strong>场景组件</strong> 类型，本身需要物理位置。但 <strong>运动控制器</strong></p></li><li class="Default"><p>Pawn拥有名为 <code>GetMovementComponent</code> 的函数，用于提供引擎中其他类访问该Pawn当前所用Pawn移动组件的权限。需覆盖该函数，使其返回自定义Pawn移动组件。在 <code>CollidingPawn.h</code> 中的类定义中，需添加：
</p><pre class="prettyprint"><code>virtual UPawnMovementComponent&#42; GetMovementComponent() const override;</code></pre>
<p>而在 <code>CollidingPawn.cpp</code> 中，需按以下所示，添加覆盖函数的定义：
</p><pre class="prettyprint"><code>UPawnMovementComponent&#42; ACollidingPawn::GetMovementComponent() const
{
    return OurMovementComponent;
}</code></pre></li><li class="Default"><p>设置新的Pawn移动组件后，可创建代码处理Pawn会接收的输入。首先在 <code>CollidingPawn.h</code> 中的类定义内声明以下函数：
</p><pre class="prettyprint"><code>void MoveForward(float AxisValue);
void MoveRight(float AxisValue);
void Turn(float AxisValue);
void ParticleToggle();</code></pre>
<p>在 <code>CollidingPawn.cpp</code> 中，按以下所示，添加此类函数的定义：
</p><pre class="prettyprint"><code>    void ACollidingPawn::MoveForward(float AxisValue)
    {
        if (OurMovementComponent &amp;&amp; (OurMovementComponent-&gt;UpdatedComponent == RootComponent))
        {
            OurMovementComponent-&gt;AddInputVector(GetActorForwardVector() &#42; AxisValue);
        }
    }

    void ACollidingPawn::MoveRight(float AxisValue)
    {
        if (OurMovementComponent &amp;&amp; (OurMovementComponent-&gt;UpdatedComponent == RootComponent))
        {
            OurMovementComponent-&gt;AddInputVector(GetActorRightVector() &#42; AxisValue);
        }
    }

    void ACollidingPawn::Turn(float AxisValue)
    {
        FRotator NewRotation = GetActorRotation();
        NewRotation.Yaw += AxisValue;
        SetActorRotation(NewRotation);
    }

    void ACollidingPawn::ParticleToggle()
    {
        if (OurParticleSystem &amp;&amp; OurParticleSystem-&gt;Template)
        {
            OurParticleSystem-&gt;ToggleActive();
        }
    }</code></pre></li><li class="Default"><p>现在只需将函数绑定到输入事件。将下列代码添加到 <code>ACollidingPawn::SetupPlayerInputComponent</code>：
</p><pre class="prettyprint"><code>InInputComponent-&gt;BindAction("ParticleToggle", IE&#95;Pressed, this, &amp;ACollidingPawn::ParticleToggle);

InInputComponent-&gt;BindAxis("MoveForward", this, &amp;ACollidingPawn::MoveForward);
InInputComponent-&gt;BindAxis("MoveRight", this, &amp;ACollidingPawn::MoveRight);
InInputComponent-&gt;BindAxis("Turn", this, &amp;ACollidingPawn::Turn);</code></pre></li><li class="Default"><p>现已完成编程，可返回 <strong>虚幻编辑器</strong> 并按 <strong>编译</strong> 按钮加载更改。
</p></li></ol><p>编程工作已结束，现可将自定义Pawn放入场景进行移动。
</p><h3 id="最终代码">最终代码</h3>
<p><strong>CollidingPawn.h</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/Pawn.h"
#include "CollidingPawn.generated.h"

UCLASS()
class HOWTO&#95;COMPONENTS&#95;API ACollidingPawn : public APawn
{
    GENERATED&#95;BODY()

public:
    // 设置此Pawn属性的默认值
    ACollidingPawn();

protected:
    // 游戏开始或生成时调用
    virtual void BeginPlay() override;

public:
    // 逐帧调用
    virtual void Tick( float DeltaSeconds ) override;

    // 调用以将功能与输入绑定
    virtual void SetupPlayerInputComponent(class UInputComponent&#42; InInputComponent) override;

    UPROPERTY()
    class UParticleSystemComponent&#42; OurParticleSystem;

    UPROPERTY()
    class UCollidingPawnMovementComponent&#42; OurMovementComponent;

    virtual UPawnMovementComponent&#42; GetMovementComponent() const override;

    void MoveForward(float AxisValue);
    void MoveRight(float AxisValue);
    void Turn(float AxisValue);
    void ParticleToggle();
};</code></pre>
<p><strong>CollidingPawn.cpp</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#include "CollidingPawn.h"
#include "CollidingPawnMovementComponent.h"
#include "UObject/ConstructorHelpers.h"
#include "Particles/ParticleSystemComponent.h"
#include "Components/SphereComponent.h"
#include "Camera/CameraComponent.h"
#include "GameFramework/SpringArmComponent.h"

// 设置默认值
ACollidingPawn::ACollidingPawn()
{
    // 设置该Pawn以逐帧调用Tick()。如无需此功能，可关闭以提高性能。
    PrimaryActorTick.bCanEverTick = true;

    // 根组件将成为对物理反应的球体
    USphereComponent&#42; SphereComponent = CreateDefaultSubobject&lt;USphereComponent&gt;(TEXT("RootComponent"));
    RootComponent = SphereComponent;
    SphereComponent-&gt;InitSphereRadius(40.0f);
    SphereComponent-&gt;SetCollisionProfileName(TEXT("Pawn"));

    // 创建并放置网格体组件，以便查看球体位置
    UStaticMeshComponent&#42; SphereVisual = CreateDefaultSubobject&lt;UStaticMeshComponent&gt;(TEXT("VisualRepresentation"));
    SphereVisual-&gt;SetupAttachment(RootComponent);
    static ConstructorHelpers::FObjectFinder&lt;UStaticMesh&gt; SphereVisualAsset(TEXT("/Game/StarterContent/Shapes/Shape&#95;Sphere.Shape&#95;Sphere"));
    if (SphereVisualAsset.Succeeded())
    {
        SphereVisual-&gt;SetStaticMesh(SphereVisualAsset.Object);
        SphereVisual-&gt;SetRelativeLocation(FVector(0.0f, 0.0f, -40.0f));
        SphereVisual-&gt;SetWorldScale3D(FVector(0.8f));
    }

    // 创建可激活或停止的粒子系统
    OurParticleSystem = CreateDefaultSubobject&lt;UParticleSystemComponent&gt;(TEXT("MovementParticles"));
    OurParticleSystem-&gt;SetupAttachment(SphereVisual);
    OurParticleSystem-&gt;bAutoActivate = false;
    OurParticleSystem-&gt;SetRelativeLocation(FVector(-20.0f, 0.0f, 20.0f));
    static ConstructorHelpers::FObjectFinder&lt;UParticleSystem&gt; ParticleAsset(TEXT("/Game/StarterContent/Particles/P&#95;Fire.P&#95;Fire"));
    if (ParticleAsset.Succeeded())
    {
        OurParticleSystem-&gt;SetTemplate(ParticleAsset.Object);
    }

    // 使用弹簧臂给予摄像机平滑自然的运动感。
    USpringArmComponent&#42; SpringArm = CreateDefaultSubobject&lt;USpringArmComponent&gt;(TEXT("CameraAttachmentArm"));
    SpringArm-&gt;SetupAttachment(RootComponent);
    SpringArm-&gt;SetRelativeRotation(FRotator(-45.f, 0.f, 0.f));
    SpringArm-&gt;TargetArmLength = 400.0f;
    SpringArm-&gt;bEnableCameraLag = true;
    SpringArm-&gt;CameraLagSpeed = 3.0f;

    // 创建摄像机并附加到弹簧臂
    UCameraComponent&#42; Camera = CreateDefaultSubobject&lt;UCameraComponent&gt;(TEXT("ActualCamera"));
    Camera-&gt;SetupAttachment(SpringArm, USpringArmComponent::SocketName);

    // 控制默认玩家
    AutoPossessPlayer = EAutoReceiveInput::Player0;

    // 创建移动组件的实例，并要求其更新根组件。
    OurMovementComponent = CreateDefaultSubobject&lt;UCollidingPawnMovementComponent&gt;(TEXT("CustomMovementComponent"));
    OurMovementComponent-&gt;UpdatedComponent = RootComponent;
}

// 游戏开始或生成时调用
void ACollidingPawn::BeginPlay()
{
    Super::BeginPlay();

}

// 逐帧调用
void ACollidingPawn::Tick( float DeltaTime )
{
    Super::Tick( DeltaTime );

}

// 调用以将功能与输入绑定
void ACollidingPawn::SetupPlayerInputComponent(class UInputComponent&#42; InInputComponent)
{
    Super::SetupPlayerInputComponent(InInputComponent);

    InInputComponent-&gt;BindAction("ParticleToggle", IE&#95;Pressed, this, &amp;ACollidingPawn::ParticleToggle);

    InInputComponent-&gt;BindAxis("MoveForward", this, &amp;ACollidingPawn::MoveForward);
    InInputComponent-&gt;BindAxis("MoveRight", this, &amp;ACollidingPawn::MoveRight);
    InInputComponent-&gt;BindAxis("Turn", this, &amp;ACollidingPawn::Turn);
}

UPawnMovementComponent&#42; ACollidingPawn::GetMovementComponent() const
{
    return OurMovementComponent;
}

void ACollidingPawn::MoveForward(float AxisValue)
{
    if (OurMovementComponent &amp;&amp; (OurMovementComponent-&gt;UpdatedComponent == RootComponent))
    {
        OurMovementComponent-&gt;AddInputVector(GetActorForwardVector() &#42; AxisValue);
    }
}

void ACollidingPawn::MoveRight(float AxisValue)
{
    if (OurMovementComponent &amp;&amp; (OurMovementComponent-&gt;UpdatedComponent == RootComponent))
    {
        OurMovementComponent-&gt;AddInputVector(GetActorRightVector() &#42; AxisValue);
    }
}

void ACollidingPawn::Turn(float AxisValue)
{
    FRotator NewRotation = GetActorRotation();
    NewRotation.Yaw += AxisValue;
    SetActorRotation(NewRotation);
}

void ACollidingPawn::ParticleToggle()
{
    if (OurParticleSystem &amp;&amp; OurParticleSystem-&gt;Template)
    {
        OurParticleSystem-&gt;ToggleActive();
    }
}</code></pre>
<p><strong>CollidingPawnMovementComponent.h</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/PawnMovementComponent.h"
#include "CollidingPawnMovementComponent.generated.h"

/&#42;&#42;
    &#42; 
    &#42;/
UCLASS()
class HOWTO&#95;COMPONENTS&#95;API UCollidingPawnMovementComponent : public UPawnMovementComponent
{
    GENERATED&#95;BODY()

public:
    virtual void TickComponent(float DeltaTime, enum ELevelTick TickType, FActorComponentTickFunction &#42;ThisTickFunction) override;  
};</code></pre>
<p><strong>CollidingPawnMovementComponent.cpp</strong>
</p><pre class="prettyprint"><code>// Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.

#include "CollidingPawnMovementComponent.h"

void UCollidingPawnMovementComponent::TickComponent(float DeltaTime, enum ELevelTick TickType, FActorComponentTickFunction &#42;ThisTickFunction)
{
    Super::TickComponent(DeltaTime, TickType, ThisTickFunction);

    // 确保所有事物持续有效，以便进行移动。
    if (!PawnOwner &#124;&#124; !UpdatedComponent &#124;&#124; ShouldSkipUpdate(DeltaTime))
    {
        return;
    }

    // 获取（然后清除）ACollidingPawn::Tick中设置的移动向量
    FVector DesiredMovementThisFrame = ConsumeInputVector().GetClampedToMaxSize(1.0f) &#42; DeltaTime &#42; 150.0f;
    if (!DesiredMovementThisFrame.IsNearlyZero())
    {
        FHitResult Hit;
        SafeMoveUpdatedComponent(DesiredMovementThisFrame, UpdatedComponent-&gt;GetComponentRotation(), true, Hit);

        // 若发生碰撞，尝试滑过去
        if (Hit.IsValidBlockingHit())
        {
            SlideAlongSurface(DesiredMovementThisFrame, 1.f - Hit.Time, Hit.Normal, Hit);
        }
    }
};</code></pre>
<h2 id="5.在编辑器中运行">5.在编辑器中运行</h2>
<ol ><li class="Default"><p>在 <strong>虚幻编辑器</strong> 中，可按 <strong>编译</strong> 按钮加载代码更改。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/CompileFromEditor.jpg">
		<img class="  lazyload" alt="CompileFromEditor.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/CompileFromEditor.jpg" />
</picture>

</p></li><li class="Default"><p>需将 <strong>CollidingPawn</strong> 实例放入场景。可在 <strong>内容浏览器</strong> 的"C++ Classes/HowTo_Components/CollidingPawn"下找到该类。
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ClassInContentBrowser.jpg">
		<img class="  lazyload" alt="ClassInContentBrowser.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ClassInContentBrowser.jpg" />
</picture>

</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/LevelEditorBeforePlay.jpg">
		<img class="  lazyload" alt="LevelEditorBeforePlay.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/LevelEditorBeforePlay.jpg" />
</picture>

</p></li><li class="Default"><p>按 <strong>运行</strong>，球体便会随WASD移动，随鼠标转动，并在场景中的物体（如桌子和椅子）上碰撞和滑动，或需要放入场景的任何物理对象。还可使用空格键向自己点火（或扑灭）！
</p><p><picture>
		<source data-srcset="./../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/CollidingAndOnFire.jpg">
		<img class="  lazyload" alt="CollidingAndOnFire.png" data-src="../../../../../Images/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/CollidingAndOnFire.jpg" />
</picture>

</p></li></ol><p><strong>虚幻引擎4</strong> 提供各式 <strong>组件</strong> - 目前仅简略介绍了部分常用组件。请尝试探究内置组件，或自己编写组件！组件灵活且功能强大，可协助项目代码保持整洁和可重用性。
</p><h2 id="6.自行尝试！">6.自行尝试！</h2>
<p>利用所学内容，尝试以下操作：
</p><ul ><li class="Default"><p>创建在轨道上自动围绕父项运行的 <strong>组件</strong>。
</p></li><li class="Default"><p>编译最多生成三个子项的组件，此类子项一段时间后会自行消失。
</p></li><li class="Default"><p>了解通过组件将完整 <strong>Actor</strong> 附加到其他Actor的方法。
</p></li></ul><p>关于本教程中涵盖的细节：
</p><ul ><li class="Default"><p>欲了解组件的更多相关信息，浏览<a id="content_link"filter-data="tag_component tag_components" href="../../../../Basics/Components/index.html" ><span>组件</span></a>页面。
</p></li><li class="Default"><p>欲学习更多教程，参阅<a id="content_link" href="../index.html" ><span>C++ 编程教程</span></a>页面。
</p></li></ul>
																	</div>
					<!-- End of Markdown converted page content -->
				</div>
												<div id="pageTags">
				<div class="title">标签</div>
					<div>
					<div class="keyword_tag_filter"><a id="tag_link" href="../../../../SiteIndex/index.html?tags=quickstart">quickstart</a></div>
<div class="keyword_tag_filter"><a id="tag_link" href="../../../../SiteIndex/index.html?tags=programming">programming</a></div>
<div class="keyword_tag_filter"><a id="tag_link" href="../../../../SiteIndex/index.html?tags=collision">collision</a></div>
<div class="keyword_tag_filter"><a id="tag_link" href="../../../../SiteIndex/index.html?tags=component">component</a></div>
<div class="keyword_tag_filter"><a id="tag_link" href="../../../../SiteIndex/index.html?tags=pawn">pawn</a></div>
					</div>
				</div>
								<div id="recommendations"></div>			</div>
						<div id="footer"></div>									<div id="announcement">
			<div style="display:inline-block;margin:5px;">
				欢迎帮助改进虚幻引擎文档！请告诉我们该如何更好地为您服务。
			</div>
			<div style="margin:5px;display:inline-block;">
				<div class="btn action" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();window.open('https://epicgames.questionpro.com/t/AP9dGZkjp4');createCookie('announcement-read', new Date().getTime(), 30);">填写问卷调查</div>
				<div class="btn btn-default" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();createCookie('announcement-read', new Date().getTime(), 30);">取消</div>
			</div>
			<div class="btn-close" style="position:absolute;right:5px;top:10px;padding:3px;width:14px;height:14px;" onclick="$('#announcement').hide();"></div>
			</div>
					</div>
	</div></body>

<!-- Mirrored from docs.unrealengine.com/4.26/zh-CN/ProgrammingAndScripting/ProgrammingWithCPP/CPPTutorials/Components/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 17 Jan 2024 11:10:40 GMT -->
</html>
