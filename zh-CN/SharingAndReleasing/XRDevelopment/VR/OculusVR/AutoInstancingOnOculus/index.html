<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<!-- Mirrored from docs.unrealengine.com/4.26/zh-CN/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 17 Jan 2024 12:43:25 GMT -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../../../../../../Include/Javascript/common_zh-CN.js" type="text/javascript"></script>
	<script type="text/javascript">
		var time = new Date(0);
		var preview = false;
		var relativeHTMLPath = "https://docs.unrealengine.com/4.26/";
				var pageid = 0;
				var heroimage = "";
				var lang = "zh-CN";
				var basePath = document.location.pathname.substring(0, document.location.pathname.indexOf('/' + lang + '/') + lang.length + 1);
		document.write('<base href="' +  encodeURI(basePath) + '/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/" />');
				var udnCSS = '../../../../../../Include/CSS/udn_public.css';
		var udnLangCSS = '';
				udnLangCSS = './../../../../../../Include/CSS/udn_public_CN.css">';
				var udnOverrideCSS = '../../../../../../Include/CSS/skin_overrides.css';
		var udnOverrideDarkCSS = '../../../../../../Include/CSS/skin_overrides_dark.css';
		var fancyboxCSS = '../../../../../../Include/CSS/jquery.fancybox.css';
		var jqueryuiCSS = '../../../../../../Include/CSS/jquery-ui.min.css';
		var qtipCSS = '../../../../../../Include/CSS/jquery.qtip.css';
		var prettifyCSS = '../../../../../../Include/CSS/prettify.css';
		var navbarCSS = '../../../../../../Include/CSS/navBar.css';
		var twentytwentyCSS = '../../../../../../Include/CSS/twentytwenty.css';
		var recommendationsCSS = '../../../../../../Include/CSS/jquery.recommendations.css';
	</script>
    <title>Oculus上的自动实例化 | 虚幻引擎文档</title>
    	    <meta name=viewport content="width=device-width, initial-scale=1" />
	<meta http-equiv="Cache-control" content="no-store">
    <script  src="../../../../../../Include/Javascript/CustomEvent.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/jquery-3.4.0.min.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/udn.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/udn_extras.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/jquery-ui.min.js" type="text/javascript"></script>
	    <script  src="../../../../../../Include/Javascript/informational.js" type="text/javascript"></script>
	    <script  src="../../../../../../Include/Javascript/jquery.fancybox.pack.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/jquery.qtip.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/prettify.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/jquery.slimscroll.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/jquery.event.move.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/jquery.twentytwenty.js" type="text/javascript"></script>
    <script  src="../../../../../../Include/Javascript/lazysizes.min.js" type="text/javascript"></script>
	    <script  src="../../../../../../Include/Javascript/jquery.recommendations.js" type="text/javascript"></script>
	
    <link async rel="icon" href="../../../../../../../favicon.png" type="image/x-icon" />
    <link async rel="shortcut icon" href="../../../../../../../favicon.png" type="image/x-icon" />
    <link async href="../../../../../../Include/Images/touch_icon.png" rel="apple-touch-icon" />
    <link async href="../../../../../../Include/Images/touch_icon_114.png" sizes="114x114" rel="apple-touch-icon" />    
		<script  src="../../../../../../Include/Javascript/CollapsibleLists.js" type="text/javascript"></script>
	<script  src="../../../../../../Include/Javascript/navigationBarUI.js"></script>
	<script  src="../../../../../../Include/Javascript/navigationBar.js"></script>
		
	<link rel="alternate" href="https://docs.unrealengine.com/latest/en-US/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/" hreflang="x-default" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/zh-CN/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/" hreflang="zh-CN" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/ja/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/" hreflang="ja" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/ko/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/" hreflang="ko" />

	<meta name="intsourcechangelist" content="15368555" />
<meta name="availability" content="Public" />
<meta name="title" content="Oculus上的自动实例化" />
<meta name="description" content="自动实例化对实例化绘制调用的影响是降低虚幻引擎中网格体渲染开销并提升渲染性能的关键。" />
<meta name="parent" content="SharingAndReleasing/XRDevelopment/VR/OculusVR" />
<meta name="version" content="4.26" />
<meta name="type" content="overview" />
<meta name="keywords" content="auto instancing" />
<meta name="keywords" content="oculus" />
<meta name="related" content="ProgrammingAndScripting/Rendering/MeshDrawingPipeline" />
<meta name="related" content="SharingAndReleasing/Mobile/Rendering/HowTo/AutoInstancingOnMobile" />
<meta name="crumbs" content="%ROOT%,SharingAndReleasing,SharingAndReleasing/XRDevelopment,SharingAndReleasing/XRDevelopment/VR,SharingAndReleasing/XRDevelopment/VR/OculusVR" />

	<meta name="twitter:card" content="summary_large_image" />
	<meta property="og:title" content="Oculus上的自动实例化" />
	<meta property="og:description" content="在UE4中为Oculus Quest调试自动实例化" />
		<meta property="og:image" content="" />
	</head>
<body id="webbgThree" style="visibility: hidden;" onload="document.body.style.visibility='visible';">
			<script>window.__tracking_base = 'https://tracking.unrealengine.com/';</script>
	<script src="../../../../../../../../tracking.unrealengine.com/tracking.js" async></script>    <div id="webThree">
				<div id="page_head">
			<edc-navigation blackListLangCodes='["de-de","es-es","es-mx","fr-fr","it-it","pt-br","ru-ru","pl-pl","tr-tr"]' locale="zh-CN" ></edc-navigation>
						<div id="pagenav">
				<div class="crumbs" id="crumbs">
<span id="versionContainer">
	<span id="versionSelect" class="btn btn-version" onclick="ToggleMenu($('#versionMenu'), $(this));"></span>
	<div id="versionMenu">
		<div id="4_26" data-version="4.26" class="btn btn-select" onclick="createCookie('version', '4.26', 365);SwitchVersion('4.26');">Unreal Engine 4.26 Documentation</div>
		<div id="4_27" data-version="4.27" class="btn btn-select" onclick="createCookie('version', '4.27', 365);SwitchVersion('4.27');">Unreal Engine 4.27 Documentation</div>
		<div id="5_0" data-version="5.0" class="btn btn-select" onclick="createCookie('version', '5.0', 365);SwitchVersion('5.0');">Unreal Engine 5.0 Documentation</div>
		<div id="5_1" data-version="5.1" class="btn btn-select" onclick="createCookie('version', '5.1', 365);SwitchVersion('5.1');">Unreal Engine 5.1 Documentation</div>
		<div id="5_2" data-version="5.2" class="btn btn-select" onclick="createCookie('version', '5.2', 365);SwitchVersion('5.2');">Unreal Engine 5.2 Documentation</div>
		<div id="5_3" data-version="5.3" class="btn btn-select" onclick="createCookie('version', '5.3', 365);SwitchVersion('5.3');">Unreal Engine 5.3 Documentation</div>
	</div>
</span>
	<span class="separator">></span> <a id="parent_link" href="../../../../index.html">项目分享及发布</a>

	<span class="separator">></span> <a id="parent_link" href="../../../index.html">XR开发</a>

	<span class="separator">></span> <a id="parent_link" href="../../index.html">虚拟现实开发</a>

	<span class="separator">></span> <a id="parent_link" href="../index.html">Oculus VR开发</a>

<span class="separator">></span> <span id="page">Oculus上的自动实例化</span>
</div>				<div id="pageNavRight">
								<!-- Start of Search -->
												<div id="search_container">
					<form name="bodySearch" method="get" action="https://www.unrealengine.com/zh-CN/bing-search" onsubmit="return validateSearch()">
						<input type="image" src="../../../../../../Include/Images/search_box_icon.png" class="searchbutton"/>
						<input type="hidden" name="filter" value="文档" />
						<input type="text" name="keyword" placeholder="搜索文档……" class="searchbox" autocomplete="off"/>
					</form>
				</div>
								<!-- End of Search -->
				<div id="skinContainer">
	<div id="skinSelect" class="btn btn-skin" onclick="ToggleMenu($('#skinMenu'), $(this));"></div>
	<div id="skinMenu">
		<div id="light" class="btn btn-select" onclick="createCookie('skin', 'light', 365);location.reload();">Light Theme</div>
		<div id="dark" class="btn btn-select" onclick="createCookie('skin', 'dark', 365);location.reload();">Dark Theme</div>
	</div>
</div>				</div>
			</div>
		</div>						<div id="navWrapper">
			<div id="nav-filter-container">
				<div id="nav-filter-inner">
					<form>
						<input type="text" placeholder="Filter pages..." id="nav-filter" onchange="clearTimeout(filterTimer); filterTimer = setTimeout(updateNavTreeFilter,250, this.value);if(this.value.length == 0){$('#filter-clear').hide();}else{$('#filter-clear').show();}" onkeypress="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" />
						<button class="close-icon" id="filter-clear" type="reset" onclick="clearTimeout(filterTimer); filterTimer = setTimeout(updateNavTreeFilter,250, '');$(this).hide();"></button>
					</form>
				</div>
			</div>
			<nav id="navPanel">
			</nav>
			<div id="navigation" title="Click to toggle navigation menu"><span>></span></div>
		</div>		
		<div id="splitter">
		</div>
				<div id="contentContainer">
										<div id="pagedefault">
				<div id="product-banner">
	<div id="product-logo"></div>
</div>				<div id="pagecontainer" style="padding-right:0px;">
					<!-- Start of Markdown converted page content -->
																				<div class="hero  ">
						<div class="imgContainer"><img src="#" /></div>						<div class="info">
							<div id="pageTitle">
								<h1 id="H1TitleId">Oculus上的自动实例化</h1>
							</div>	
							<h2 >在UE4中为Oculus Quest调试自动实例化</h2>
							<div id="access">
								<div class="accessContainer">
																																			</div>
							</div>
						</div>
					</div>
																				<div id="maincol">
						<div class="togglesection" id="osContainer">
	<div class="normaltitle">
		<p>Choose your operating system:</p>
	</div><div class="toggleButtons">
		<div class="btn btn-default btn-toggle OS windows" id="windows" onclick="setSelector('OS', 'windows');">
			<p>Windows</p>
		</div>
		<div class="btn btn-default btn-toggle OS mac" id="mac" onclick="setSelector('OS', 'mac');">
			<p>macOS</p>
		</div>
		<div class="btn btn-default btn-toggle OS linux" id="linux" onclick="setSelector('OS', 'linux');">
			<p>Linux</p>
		</div>
	</div>
</div>																		<div id="seeAlso">
	<div style="position:relative;">
		<div id="title">参见</div>
		<div id="pageList">
			<ul>
								<li>
					<p>
						<a id="related_link" href="../../../../../ProgrammingAndScripting/Rendering/MeshDrawingPipeline/index.html" title="包括虚幻引擎4适用参考和指南在内的产品文档">网格体绘制管道</a>
					</p>
				</li>
								<li>
					<p>
						<a id="related_link" href="../../../../Mobile/Rendering/HowTo/AutoInstancingOnMobile/index.html" title="在移动设备上启用网格体自动实例化。">移动设备上的网格体自动实例化</a>
					</p>
				</li>
							</ul>
		</div>
	</div>
</div>
																														<div class="toc">
<div style="position:relative;">
    <div class="title">
    本页面的内容
    </div>
<div id="tocScroll">
    <ul>
	    		    			    <li id="">
	<p><a id="toc_link" href="#常见的实例化不兼容">常见的实例化不兼容</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#验证">验证</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#它如何运作">它如何运作</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#缓存的绘制调用">缓存的绘制调用</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#未缓存的绘制调用">未缓存的绘制调用</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#材质">材质</a></p>
	</li>					</ul>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#cpu开销">CPU开销</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#gpu开销">GPU开销</a></p>
	</li>		    	        </ul>
</div>
</div>
</div>
<p><strong>绘制调用（draw call）</strong> 是RHI绘制对象的指令。<strong>自动实例化</strong> 这项功能会自动将多个绘制调用组合到一个实例化的绘制调用中。如果你拥有多种不同属性的相似对象，<strong>实例化绘制</strong> <strong>调用</strong> 就是用图形API绘制这些对象的多种实例的一种方法。这些对象可能拥有不同的属性，并且与网格体的渲染有关：例如位置、方向、颜色等等。 
</p><p>你可以将多个调用组合成一个调用，从而在提交图形API绘制调用时减少CPU的开销。你还可以将所有图形调用组合为一个，不过这么做需要有顶点缓冲区、统一缓冲区、着色器、光栅化模式以及其它兼容所有绘制调用的图形API状态。 
</p><div class="note">
	<p>每个引擎的兼容要求可能有所差异，这要取决于引擎对其绘制调用施加的限制。 </p>
</div><p>当自动实例化无法组合绘制调用时，通常是因为它违反了隐藏的兼容要求。理解虚幻自动实例化的工作原理可以帮助你完成调试，并发现未来的新要求。
</p><p>确保启用以下CVar：
</p><ul ><li class="Default"><p><strong>r.Mobile.SupportGPUScene=1</strong>  必须在.ini文件夹中手动设置为1，因为不是所有安卓设备都支持计算着色器。
</p></li><li class="Default"><p><strong>r.MeshDrawCommands.DynamicInstancing</strong>  默认设置为1，所以不需要手动设置。
</p></li><li class="Default"><p><strong>r.MeshDrawCommands.UseCachedCommands</strong>  默认设置为1，所以不需要手动设置。
</p></li></ul><h2 id="常见的实例化不兼容">常见的实例化不兼容</h2>
<p>如果是使用了光照材质的静态网格体组件，<a id="content_link"filter-data="tag_static_mesh tag_lightmap" href="../../../../../WorkingWithContent/Types/StaticMeshes/LightmapUnwrapping/index.html" ><span>请确保构建了光照贴图</span></a>. 
</p><p><picture>
		<source data-srcset="./../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/UpdateLighting.jpg">
		<img class="  lazyload" alt="找到构建菜单，然后选择仅构建光照来更新光照。" data-src="../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/UpdateLighting.jpg" />
</picture>

</p><p>如果没有构建光照贴图（或者它们失去时效），UE4会使用一个<a id="content_link"filter-data="tag_lighting tag_indirect_lighting_cache" href="../../../../../RenderingAndGraphics/Lightmass/IndirectLightingCache/index.html" ><span>间接光照缓存</span></a>来替代它们。间接光照缓存会通过使用 <strong>统一缓冲区</strong>（在DirectX中叫做 <strong>常量缓冲区</strong>）将照明数据传给一个绘制调用，这样可以防止绘制调用组合，因为统一缓冲区应该对每个绘制调用都是唯一的。 
</p><p>光照贴图不会有这个问题，因为它们的数据通道是专为支持实例化而有意设计的。
</p><p>要在编辑器中测试自动实例化：
</p><ol ><li class="Default"><p>确保 <strong>视图模式</strong> 为 <strong>光照</strong>、<strong>细节光照</strong> 或 <strong>反射</strong>。这是非常必要的步骤，因为许多调试视图模式都不兼容光照贴图数据通道。
</p></li><li class="Default"><p>确保以下模式为 <strong>开启</strong>：
</p><ul ><li class="Default"><p><strong>显示 > 高级 > LOD父处理</strong>
</p></li><li class="Default"><p><strong>显示 > 光照功能 > 体积光照贴图</strong>
</p></li><li class="Default"><p><strong>显示 > 光照功能 > 间接光源缓存</strong>
</p></li></ul></li><li class="Default"><p>确保以下模式为 <strong>关闭</strong>：
</p><ul ><li class="Default"><p><strong>视图模式 > 光照贴图密度</strong>
</p></li><li class="Default"><p><strong>视图模式 > 细节层级着色 > 网格体LOD着色</strong>
</p></li><li class="Default"><p><strong>视图模式 > 细节层级着色 > 层级LOD着色</strong>
</p></li><li class="Default"><p><strong>显示 > 高级 > BSP分割</strong>
</p></li><li class="Default"><p><strong>显示 > 高级 > 属性着色</strong>
</p></li><li class="Default"><p><strong>显示 > 高级 > 网格体边缘</strong>
</p></li><li class="Default"><p><strong>显示 > 高级 > 光照影响</strong>
</p></li><li class="Default"><p><strong>显示 > 高级 > 质量属性</strong>
</p></li></ul></li></ol><div class="note">
	<p>当在编辑器中测试时，如果`IsRichVew`返回为True，则所有`FStaticMeshSceneProxy<code> 都会失去`bStaticRelevance`并获得`bDynamicRelevance</code>。这样可以间接使得自动实例化排除静态网格体。
</p><p>上述调试视图模式可能使得`IsRichVew`返回为True。</p>
</div><h2 id="验证">验证</h2>
<p>使用CVar <strong>r.MeshDrawCommands.LogDynamicInstancingStats 1</strong> 可以查看自动实例化的状态。这个控制台指令可以打印出绘制调用减少的因数，也就是在实例化合并前后绘制调用数量的比率。
</p><p>如果你想知道这个软件里发生了什么，请使用<a id="content_link"filter-data="tag_performance tag_profiling tag_performance_&_profiling" href="../../../../../TestingAndOptimization/PerformanceAndProfiling/RenderDoc/index.html" ><span>RenderDoc</span></a>做一次捕捉。你应该会看到多个对象被组合为一个实例化绘制调用：
</p><div class="lightbox">
	<p><span class="non-localized"><a id="content_link" href="../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/RenderDoc.png" ><span><picture>
		<source data-srcset="./../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/RenderDoc.jpg">
		<img class="  lazyload" alt="RenderDoc会显示引擎回报的组合实例的数量。" width="600" data-src="../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/RenderDoc.jpg" />
</picture>
</span></a></span></p>
</div><div class="caption">
	<p>点击放大。RenderDoc会报告注解中实例的数量。注解由虚幻引擎发出。</p>
</div><h2 id="它如何运作">它如何运作</h2>
<p>因为这个系统较为复杂，我们不可能列出所有实例化不兼容的原因，但是可以展示基础的内部函数，让你在需要调试实例化不兼容时有更深的理解。
</p><p>在查看自动实例化运作的源代码之前，请先关闭以下CVar：
</p><ul ><li class="Default"><p><strong>r.ParallelInitViews=0</strong>
</p></li><li class="Default"><p><strong>r.MeshDrawCommands.ParallelPassSetup=0</strong>
</p></li></ul><h3 id="缓存的绘制调用">缓存的绘制调用</h3>
<p>每个绘制调用都有相关的`FCachedMeshDrawCommandInfo::StateBucketId`，这是一个32位的整数，可以缓存绘制调用。
</p><p>虚幻会缓存`StaticMeshComponent`，它不会更改性能。该行为由`r.MeshDrawCommands.UseCachedCommands`控制，默认设置为 **1**。 
</p><p>这意味着当绘制调用被缓存时，就会计算`FCachedMeshDrawCommandInfo::StateBucketId`的值。它会在`FCachedPassMeshDrawListContext::FinalizeCommand`中进行。`FCachedMeshDrawCommandInfo::StateBucketId`的计算取决于`FMeshDrawCommand::GetDynamicInstancingHash`计算的哈希值评估。在该函数中，你可以看到哈希值取决于以下属性：
</p><ul ><li class="Default"><p><code>IndexBuffer</code>
</p></li><li class="Default"><p><code>VertexBuffers</code>
</p></li><li class="Default"><p><code>VertexStreams</code>
</p></li><li class="Default"><p><code>PipelineId</code>
</p></li><li class="Default"><p><code>DynamicInstancingHash</code>
</p></li><li class="Default"><p><code>FirstIndex</code>
</p></li><li class="Default"><p><code>NumPrimitives</code>
</p></li><li class="Default"><p><code>NumInstances</code>
</p></li><li class="Default"><p><code>IndirectArgsBufferOrBaseVertexIndex</code>
</p></li><li class="Default"><p><code>NumVertices</code>
</p></li><li class="Default"><p><code>StencilRefAndPrimitiveIdStreamIndex</code>
</p></li></ul><p><code>IndexBuffer</code>、<code>VertexBuffers</code>、<code>VertexStreams`和`NumVertices`是由静态网格体决定的；因此你的所有对象都需要引用同一个静态网格体。</code>PipelineId`由材质和渲染器决定。`DynamicInstancingHash`也由材质决定。剩余的属性与UE4的一般用例无关。
</p><h3 id="未缓存的绘制调用">未缓存的绘制调用</h3>
<p>`MeshPassProcessor.h`中的`FVisibleMeshDrawCommand`类代表了动态生成的未缓存的绘制调用，例如SkeletalMeshComponent或其它编辑器控件。不过目前它还无法使用，而且从UE4.25开始，未缓存的绘制调用不支持自动实例化。<br /></p><h3 id="材质">材质</h3>
<p>由于`PipelineId`和`DynamicInstancingHash`的原因，绘制调用的实例化兼容可能取决于材质。<code>PipelineId`受到材质的混合模式和着色模型选择的影响。使用不同的混合模式和着色器模型会导致不同的管线状态对象。</code>DynamicInstancingHash`是由`FMeshDrawShaderBindings::GetDynamicInstancingHash`函数计算的。以下属性决定了输出哈希值的属性。
</p><table >
	<caption></caption>
	<col align=""/>
	<col align=""/>
	<thead>
		<tr >

	<th rowspan="1" colspan="1" >
			<p>属性 </p>
			</th>
	
	<th rowspan="1" colspan="1" >
			<p>描述 </p>
			</th>
	
</tr>	</thead>
<tbody>
	<tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>LooseParametersHash</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>它是从材质纹理计算的哈希值的累积。</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>UniformBufferHash</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>参考材质参数的使用或<a id="content_link"filter-data="tag_materials" href="../../../../../RenderingAndGraphics/Materials/ParameterCollections/index.html" ><span>材质参数集</span></a>。</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p>Size（大小）, frequencies（频率）</p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>这两个都是由材质生成的着色器结果决定的。</p>
			</td>
	
</tr></tbody>
</table><p>如果两种材质引用了同样的纹理集和统一缓冲区，那么二者就是兼容的。该统一缓冲区需要：简洁光照缓存能够防止实例化；上传带有唯一统一缓冲区的光照数据，因此可更改`UniformBufferHash`。
</p><div class="note">
	<p>从虚幻引擎4.25版本开始，使用材质参数和参数集就不会防止实例化了。虚幻材质表达式缓存让相同参数的混合到相同的统一缓冲区。</p>
</div><h2 id="cpu开销">CPU开销</h2>
<p>自动实例化会在视锥剔除之后发生，这意味如果屏幕上的一些内容不可见，它就不会参与绘制调用的合并，这样可以节省计算开销。 
</p><p>但是，分类和组合绘制调用依然会在CPU周期产生开销；这意味只有当你知道自己的场景是由无法实例化的不兼容组件组成时，才应该关闭自动实例化。 
</p><p>通过检查CPU合并绘制调用的开销，表明该操作开销非常低（对移动端VR而言）。它们也会被分布到多个核心中。
</p><div class="lightbox">
	<p><span class="non-localized"><a id="content_link" href="../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/StatDynamicInstancing.png" ><span><picture>
		<source data-srcset="./../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/StatDynamicInstancing.jpg">
		<img class="  lazyload" alt="动态实例化显示的CPU合并绘制调用所用的开销。" width="600" data-src="../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/StatDynamicInstancing.jpg" />
</picture>
</span></a></span></p>
</div><p>`STAT_DynamicInstancingOfVisibleMeshDrawCommands`是一项CPU追踪活动，它会呈现收集可兼容绘制调用时的CPU开销。
</p><h2 id="gpu开销">GPU开销</h2>
<p>GPU开销与计算着色器如何将图元的统一缓冲区放入可添加索引的数据结构中有关。只有在每个实例数据都更改并且需要更新时才会执行此计算着色器。
</p><p>为了确保UE4每帧都会更新每个实例数据，在命令提示符或已连接设备的PowerShell中使用这个指令：
</p><pre class="prettyprint"><code>adb shell "am broadcast -a android.intent.action.RUN -e cmd 'r.GPUScene.UploadEveryFrame 1'"</code></pre>
<p>UploadEveryFrame打开之后，RenderDoc for Oculus的RenderStage追踪功能就会测量计算着色器的开销。
</p><p><picture>
		<source data-srcset="./../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/OculusCapture.jpg">
		<img class="  lazyload" alt="RenderDoc for Oculus的捕捉并显示开销。" data-src="../../../../../../Images/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/OculusCapture.jpg" />
</picture>

</p><p>上述RenderDoc for Oculus捕捉会显示计算着色器开销，一个使用基础材质构成的球体中有15个实例，安排这些实例耗时27毫秒。这比渲染单格的开销要低。
</p>
																	</div>
					<!-- End of Markdown converted page content -->
				</div>
												<div id="pageTags">
				<div class="title">标签</div>
					<div>
					<div class="keyword_tag_filter"><a id="tag_link" href="../../../../../SiteIndex/index.html?tags=auto%20instancing">auto instancing</a></div>
<div class="keyword_tag_filter"><a id="tag_link" href="../../../../../SiteIndex/index.html?tags=oculus">oculus</a></div>
					</div>
				</div>
								<div id="recommendations"></div>			</div>
						  									<div id="announcement">
			<div style="display:inline-block;margin:5px;">
				欢迎帮助改进虚幻引擎文档！请告诉我们该如何更好地为您服务。
			</div>
			<div style="margin:5px;display:inline-block;">
				<div class="btn action" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();window.open('https://epicgames.questionpro.com/t/AP9dGZkjp4');createCookie('announcement-read', new Date().getTime(), 30);">填写问卷调查</div>
				<div class="btn btn-default" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();createCookie('announcement-read', new Date().getTime(), 30);">取消</div>
			</div>
			<div class="btn-close" style="position:absolute;right:5px;top:10px;padding:3px;width:14px;height:14px;" onclick="$('#announcement').hide();"></div>
			</div>
					</div>
	</div></body>

<!-- Mirrored from docs.unrealengine.com/4.26/zh-CN/SharingAndReleasing/XRDevelopment/VR/OculusVR/AutoInstancingOnOculus/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 17 Jan 2024 12:43:28 GMT -->
</html>
