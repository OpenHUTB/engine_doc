<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<!-- Mirrored from docs.unrealengine.com/4.26/zh-CN/TestingAndOptimization/Automation/AutomationDriver/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 17 Jan 2024 12:41:39 GMT -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../../../../Include/Javascript/common_zh-CN.js" type="text/javascript"></script>
	<script type="text/javascript">
		var time = new Date(0);
		var preview = false;
		var relativeHTMLPath = "https://docs.unrealengine.com/4.26/";
				var pageid = 0;
				var heroimage = "";
				var lang = "zh-CN";
				var basePath = document.location.pathname.substring(0, document.location.pathname.indexOf('/' + lang + '/') + lang.length + 1);
		document.write('<base href="' +  encodeURI(basePath) + '/TestingAndOptimization/Automation/AutomationDriver/" />');
				var udnCSS = '../../../../Include/CSS/udn_public.css';
		var udnLangCSS = '';
				udnLangCSS = './../../../../Include/CSS/udn_public_CN.css">';
				var udnOverrideCSS = '../../../../Include/CSS/skin_overrides.css';
		var udnOverrideDarkCSS = '../../../../Include/CSS/skin_overrides_dark.css';
		var fancyboxCSS = '../../../../Include/CSS/jquery.fancybox.css';
		var jqueryuiCSS = '../../../../Include/CSS/jquery-ui.min.css';
		var qtipCSS = '../../../../Include/CSS/jquery.qtip.css';
		var prettifyCSS = '../../../../Include/CSS/prettify.css';
		var navbarCSS = '../../../../Include/CSS/navBar.css';
		var twentytwentyCSS = '../../../../Include/CSS/twentytwenty.css';
		var recommendationsCSS = '../../../../Include/CSS/jquery.recommendations.css';
	</script>
    <title>自动化驱动程序 | 虚幻引擎文档</title>
    	    <meta name=viewport content="width=device-width, initial-scale=1" />
	<meta http-equiv="Cache-control" content="no-store">
    <script  src="../../../../Include/Javascript/CustomEvent.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/jquery-3.4.0.min.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/udn.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/udn_extras.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/jquery-ui.min.js" type="text/javascript"></script>
	    <script  src="../../../../Include/Javascript/informational.js" type="text/javascript"></script>
	    <script  src="../../../../Include/Javascript/jquery.fancybox.pack.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/jquery.qtip.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/prettify.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/jquery.slimscroll.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/jquery.event.move.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/jquery.twentytwenty.js" type="text/javascript"></script>
    <script  src="../../../../Include/Javascript/lazysizes.min.js" type="text/javascript"></script>
	    <script  src="../../../../Include/Javascript/jquery.recommendations.js" type="text/javascript"></script>
	
    <link async rel="icon" href="../../../../../favicon.png" type="image/x-icon" />
    <link async rel="shortcut icon" href="../../../../../favicon.png" type="image/x-icon" />
    <link async href="../../../../Include/Images/touch_icon.png" rel="apple-touch-icon" />
    <link async href="../../../../Include/Images/touch_icon_114.png" sizes="114x114" rel="apple-touch-icon" />    
		<script  src="../../../../Include/Javascript/CollapsibleLists.js" type="text/javascript"></script>
	<script  src="../../../../Include/Javascript/navigationBarUI.js"></script>
	<script  src="../../../../Include/Javascript/navigationBar.js"></script>
		
	<link rel="alternate" href="https://docs.unrealengine.com/latest/en-US/TestingAndOptimization/Automation/AutomationDriver/" hreflang="x-default" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/zh-CN/TestingAndOptimization/Automation/AutomationDriver/" hreflang="zh-CN" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/ja/TestingAndOptimization/Automation/AutomationDriver/" hreflang="ja" />
<link rel="alternate" href="https://docs.unrealengine.com/latest/ko/TestingAndOptimization/Automation/AutomationDriver/" hreflang="ko" />

	<meta name="redirect" content="Programming/Automation/AutomationDriver" />
<meta name="intsourcechangelist" content="16257625" />
<meta name="availability" content="Public" />
<meta name="title" content="自动化驱动程序" />
<meta name="description" content="概述新的自动化驱动程序特性，该特性允许程序员模拟用户输入。" />
<meta name="type" content="overview" />
<meta name="skilllevel" content="advanced" />
<meta name="version" content="4.22" />
<meta name="parent" content="TestingAndOptimization/Automation" />
<meta name="order" content="" />
<meta name="keywords" content="Automation Driver" />
<meta name="topic-image" content="AutomationDriver_topic.png" />
<meta name="reference-image" content="AutomationDriver.gif" />
<meta name="related" content="TestingAndOptimization/Automation/AutomationSpec" />
<meta name="crumbs" content="%ROOT%,TestingAndOptimization,TestingAndOptimization/Automation" />

	<meta name="twitter:card" content="summary_large_image" />
	<meta property="og:title" content="自动化驱动程序" />
	<meta property="og:description" content="概述新的自动化驱动程序特性，该特性允许程序员模拟用户输入。" />
		<meta property="og:image" content="" />
	</head>
<body id="webbgThree" style="visibility: hidden;" onload="document.body.style.visibility='visible';">
			<script>window.__tracking_base = 'https://tracking.unrealengine.com/';</script>
	<script src="../../../../../../tracking.unrealengine.com/tracking.js" async></script>    <div id="webThree">
				<div id="page_head">

			<edc-navigation blackListLangCodes='["de-de","es-es","es-mx","fr-fr","it-it","pt-br","ru-ru","pl-pl","tr-tr"]' locale="zh-CN" ></edc-navigation>
						<div id="pagenav">
				<div class="crumbs" id="crumbs">

	<span class="separator">></span> <a id="parent_link" href="../../index.html">测试并优化你的内容</a>

	<span class="separator">></span> <a id="parent_link" href="../index.html">自动化系统概述</a>

<span class="separator">></span> <span id="page">自动化驱动程序</span>
</div>				<div id="pageNavRight">
								<!-- Start of Search -->
												<div id="search_container">
					<form name="bodySearch" method="get" action="https://www.unrealengine.com/zh-CN/bing-search" onsubmit="return validateSearch()">
						<input type="image" src="../../../../Include/Images/search_box_icon.png" class="searchbutton"/>
						<input type="hidden" name="filter" value="文档" />
						<input type="text" name="keyword" placeholder="搜索文档……" class="searchbox" autocomplete="off"/>
					</form>
				</div>
								<!-- End of Search -->
				<div id="skinContainer">
	<div id="skinSelect" class="btn btn-skin" onclick="ToggleMenu($('#skinMenu'), $(this));"></div>
	<div id="skinMenu">
		<div id="light" class="btn btn-select" onclick="createCookie('skin', 'light', 365);location.reload();">Light Theme</div>
		<div id="dark" class="btn btn-select" onclick="createCookie('skin', 'dark', 365);location.reload();">Dark Theme</div>
	</div>
</div>				</div>
			</div>
		</div>						<div id="navWrapper">

			 <nav id="navPanel">
				<div class="contents-table-el"><!----><!----><!----><!----><a class="contents-table-link is-parent" href="/zh-CN/Basics/index.html">理解基础概念</a><!----></div>
				<div class="contents-table-el"><a class="contents-table-link is-parent" href="/zh-CN/WorkingWithContent/index.html">管理内容</a><!----></div>
				<div class="contents-table-el"><a class="contents-table-link is-parent" href="/zh-CN/BuildingWorlds/index.html">构建虚拟世界</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/RenderingAndGraphics/index.html">设计视觉、渲染和图形效果</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/ProgrammingAndScripting/index.html">编程和脚本编写</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/InteractiveExperiences/index.html">创建交互体验</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/AnimatingObjects/index.html">为角色和对象添加动画</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/WorkingWithMedia/index.html">使用媒体</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/ProductionPipelines/index.html">建立你的开发流程</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/TestingAndOptimization/index.html">测试并优化你的内容</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/SharingAndReleasing/index.html">项目分享及发布</a><!----></div>
				<div class="contents-table-el"> <a class="contents-table-link is-parent" href="/zh-CN/Resources/index.html">示例与教学</a><!----></div>
				<div class="contents-table-el"><a class="contents-table-link is-parent" href="/zh-CN/WhatsNew/index.html">新内容</a></div>
			</nav>
			<div id="navigation" title="Click to toggle navigation menu"><span>></span></div>
		</div>		
		<div id="splitter">
		</div>
				<div id="contentContainer">
										<div id="pagedefault">
				<div id="product-banner">
	<div id="product-logo"></div>
</div>				<div id="pagecontainer" style="padding-right:0px;">
					<!-- Start of Markdown converted page content -->
																				<div class="hero  ">
						<div class="imgContainer"><img src="#" /></div>						<div class="info">
							<div id="pageTitle">
								<h1 id="H1TitleId">自动化驱动程序</h1>
							</div>	
							<h2 >概述新的自动化驱动程序特性，该特性允许程序员模拟用户输入。</h2>
							<div id="access">
								<div class="accessContainer">
																		<div class="skill_tag_filter Advanced"><a id="skill_link" href="../../../SiteIndex/index.html?skills=Advanced">Advanced</a></div>
																	</div>
							</div>
						</div>
					</div>
																				<div id="maincol">
						<div class="togglesection" id="osContainer">
	<div class="normaltitle">
		<p>Choose your operating system:</p>
	</div><div class="toggleButtons">
		<div class="btn btn-default btn-toggle OS windows" id="windows" onclick="setSelector('OS', 'windows');">
			<p>Windows</p>
		</div>
		<div class="btn btn-default btn-toggle OS mac" id="mac" onclick="setSelector('OS', 'mac');">
			<p>macOS</p>
		</div>
		<div class="btn btn-default btn-toggle OS linux" id="linux" onclick="setSelector('OS', 'linux');">
			<p>Linux</p>
		</div>
	</div>
</div>																		<div id="seeAlso">
	<div style="position:relative;">
		<div id="title">参见</div>
		<div id="pageList">
			<ul>
								<li>
					<p>
						<a id="related_link" href="../AutomationSpec/index.html" title="概述了一种新的自动化测试类型，称为"规范"，它已经添加到我们现有的自动化测试框架中。">自动化规范</a>
					</p>
				</li>
							</ul>
		</div>
	</div>
</div>
																														<div class="toc">
<div style="position:relative;">
    <div class="title">
    本页面的内容
    </div>
<div id="tocScroll">
    <ul>
	    		    			    <li id="">
	<p><a id="toc_link" href="#它能做什么？">它能做什么？</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#它如何工作？">它如何工作？</a></p>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#如何使用它？">如何使用它？</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#使用api">使用API</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#查找元素">查找元素</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#by::id__">By::Id()</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#by::path__">By::Path()</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#路径语法">路径语法</a></p>
	</li>					</ul>
	</li>							<li id="">
	<p><a id="toc_link" href="#by::cursor__">By::Cursor()</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#by::delegate__">By::Delegate()</a></p>
	</li>					</ul>
	</li>							<li id="">
	<p><a id="toc_link" href="#执行操作">执行操作</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#元素">元素</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#序列">序列</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#操作">操作</a></p>
	</li>							<li id="">
	<p><a id="toc_link" href="#等待">等待</a></p>
	</li>					</ul>
	</li>					</ul>
	</li>		    			    <li id="">
	<p><a id="toc_link" href="#结合使用">结合使用</a></p>
			<ul>
							<li id="">
	<p><a id="toc_link" href="#最后提示">最后提示</a></p>
	</li>					</ul>
	</li>		    	        </ul>
</div>
</div>
</div>
<p><strong>自动化驱动程序（Automation Driver）</strong> 是一个新的引擎特性，利用该特性，程序员能够使用流畅的语法通过应用程序模拟用户输入。自动化驱动程序在特性集上与其他用于浏览器输入模拟的外部库非常相似，主要用于编写模拟用户行为的功能测试，就像其他这些库一样。
</p><div class="asyncgif">
	<p><picture>
		<source data-srcset="./../../../../Images/TestingAndOptimization/Automation/AutomationDriver/AutomationDriver.jpg">
		<img class="  lazyload" alt="Automation Driver" data-src="../../../../Images/TestingAndOptimization/Automation/AutomationDriver/AutomationDriver.jpg" />
</picture>
</p>
</div><h2 id="它能做什么？">它能做什么？</h2>
<p>自动化驱动程序模拟输入，这意味着它可以模拟光标移动、单击、按下、键入、滚动、拖放等等操作。这个自动化驱动程序的初始版本支持完整的传统桌面输入套件，基本上包括所有与键盘和鼠标相关的输入。未来，我们可能会将其扩展到包括触摸手势、控制器输入，甚至运动检测。
</p><p>自动化驱动程序擅长以一种流畅的、可读性强、易于维护且相对不脆弱的方式模拟该输入。最重要的是，因为自动化驱动程序模拟平台层的输入，所以它的公共API不依赖于Slate，而且只需做少量工作，就可以扩展到使用场景Actor或者更多。 
</p><div class="note">
	<p>另外，此特性还与平台无关，所以它可以在任何平台上使用，只要它能够模拟该平台的主要输入类型。 </p>
</div><h2 id="它如何工作？">它如何工作？</h2>
<p>在<a id="content_link" href="https://docs.unrealengine.com/en-US/API/Runtime/Core/index.html" ><span>核心</span></a>中，几乎所有外部输入都要经过一组接口。
自动化驱动程序创建这些接口的shim实现，利用一些基本的依赖性注入，它可以用其"传递"变体替换真正的实现。然后，这些"传递"变体就有机会委托哪些平台输入传递给应用程序，哪些不传递给应用程序，以及完全伪造自己的输入——这就是自动化驱动程序的工作方式。
</p><h2 id="如何使用它？">如何使用它？</h2>
<p>自动化驱动程序默认为禁用。您可以调用模块API上的 <code>Enable()</code> 函数来激活它。您可以调用 <code>Disable()</code> 函数来禁用它。
</p><pre class="prettyprint"><code>IAutomationDriverModule::Get().Enable();

//@todo 此处模拟用户行为

IAutomationDriverModule::Get().Disable();</code></pre>
<p>一旦激活，自动化驱动程序即开始拦截应用程序接收的几乎所有平台输入。此时您可以创建自己的驱动程序实例。
</p><pre class="prettyprint"><code>FAutomationDriverPtr Driver = IAutomationDriverModule::Get().CreateDriver();</code></pre>
<p>一旦有了自己的驱动程序实例，便可开始模拟输入。下面是一个简单示例，演示如何模拟注册表单的输入：
</p><pre class="prettyprint"><code>FDriverElementRef SignUpForm = Driver-&gt;FindElement(By::Id("Form"));
FDriverElementRef SubmitBtn = Driver-&gt;FindElement(By::Path("#Form//Submit"));

FDriverSequenceRef Sequence = Driver-&gt;CreateSequence();
Sequence-&gt;Actions()
    .Focus(SignUpForm)
    .Type(TEXT("FirstName\tLastName\tFirstName.LastName@example.com"))
    .Click(SubmitBtn);
Sequence-&gt;Perform();</code></pre>
<h3 id="使用api">使用API</h3>
<p>有两个主要API与自动化驱动程序交互——一个同步API和一个异步API。同步API是最容易编写代码的，但您不能在GameThread上运行该代码。这是因为同步API进行拦截并等待输入模拟完成后才会继续。虽然输入模拟仍然作为潜在逻辑排队在GameThread上运行，但是拦截同步驱动程序API确保永远不会通过创建死锁来处理模拟输入——要避免这样做。 
</p><p>本文中的所有示例都将使用同步API，假设没有在GameThread上执行此逻辑。 
</p><div class="note">
	<p>如果您发现这是一个具有挑战性的概念，那么您应该阅读有关新的<a id="content_link"filter-data="tag_automation_spec" href="../AutomationSpec/index.html" ><span>自动化规范</span></a>测试类型的内容。</p>
</div><h3 id="查找元素">查找元素</h3>
<p>要生成任何有用的输入，第一步是确定要交互的应用程序的关键部分。自动化驱动程序利用定位器来实现这一点，而且还有一些顺畅的方法来使用一些现有的定位器，这些定位器能够发现基于Slate的元素。
</p><h4 id="by::id__">By::Id()</h4>
<p>要实现这一点，基于Id定位元素是最理想的方法。它要求程序员用显式的自动化驱动程序元数据Id来标记控件，因此中断的可能性要小得多。
</p><p>标记控件很简单，可以像下面这样做：
</p><pre class="prettyprint"><code>SNew(STextBlock)
.Text(InViewModel, &amp;IViewModel::GetFirstName)
.AddMetaData(FDriverMetaData::Id("SignUpFormFirstNameField"))</code></pre>
<p>Id最好尽可能地明确，这样它们就不太可能与任何其他Id发生冲突，从而更容易引用它们。Id可以通过路径引用，从而由其他Id和元素限定范围。但最好生成一个唯一的Id，这样测试就不必依赖脆弱的作用域上下文。 
</p><p>例如，如果您的Id是唯一的，那么您可以像这样定位此控件： 
</p><pre class="prettyprint"><code>FDriverElementRef FirstNameField = Driver-&gt;FindElement(By::Id("SignUpFormFirstNameField")); </code></pre>
<p>如果您的Id不是唯一的，但表示一组唯一的元素，那么您可以使用以下命令立即定位所有这些元素： 
</p><pre class="prettyprint"><code>FDriverElementCollectionRef SignUpFormFields = Driver-&gt;FindElements(By::Id("SignUpFormField"));
TArray&lt;FDriverElementRef&gt; Fields = SignUpFormFields-&gt;GetElements();</code></pre>
<p>在元素集合上调用GetElements()方法实际上启动了元素发现流程，所以要注意您正在寻找的元素是否已出现。您可能需要显式地等待它们出现。 
</p><h4 id="by::path__">By::Path()</h4>
<p>按路径定位元素是当前可用的最脆弱但也最强大的定位方式。利用By::Path()定位器，您可以通过标签、Id和/或类型匹配来获取特定元素。 
</p><p>以下是一些语法示例： 
</p><pre class="prettyprint"><code>By::Path("#SignUpFormFirstNameField")
By::Path("FormField"))
By::Path("Documents//Tiles")
By::Path("&lt;SAutomationDriverSpecSuite&gt;")
By::Path("#Piano//#KeyB/&lt;STextBlock&gt;")
By::Path("#Suite//Form//Rows//#A1//&lt;SEditableText&gt;")</code></pre>
<h5 id="路径语法">路径语法</h5>
<table >
	<caption></caption>
	<col align=""/>
	<col align=""/>
	<thead>
		<tr >

	<th rowspan="1" colspan="1" >
			<p>语法</p>
			</th>
	
	<th rowspan="1" colspan="1" >
			<p>说明</p>
			</th>
	
</tr>	</thead>
<tbody>
	<tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>#SignUpFormFirstNameField</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p><code>#</code> 表示以下文本是显式Id，对于 <code>SWidget</code>，需要使用自动化驱动程序Id元数据对其进行标记。</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>FormField</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>纯文本表示一般标记，对于 <code>SWidget</code>，它需要有一个 <code>Tag</code> 或 <code>TagMetadata</code>，并具有匹配的纯文本值。</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>&lt;STextBlock&gt;</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p><code>&lt;&gt;</code> 表示类型，对于 <code>SWidget</code>，它应该是 <code>SNew</code> 构造中使用的显式类型。您可以通过查看控件反射器轻松地使用类型创建路径。</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>/</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>层级由正斜杠表示，单正斜杠表示下一个值必须与前一个匹配的元素的直接子元素匹配。</p>
			</td>
	
</tr><tr >

	<td rowspan="1" colspan="1" align="">
			<p><code>//</code></p>
			</td>
	
	<td rowspan="1" colspan="1" align="">
			<p>层级由正斜杠表示，双正斜杠表示下一个值必须与前一个匹配的元素的任何后代匹配。</p>
			</td>
	
</tr></tbody>
</table><p>未来会向路径定位器添加更多的语法选项，但目前可用的选项就是这些。 
</p><div class="note">
	<p>不支持转义字符，这意味着路径定位器无法成功匹配包含 <code>&lt;</code> 或 <code>#</code> 前缀字符的标记或Id。</p>
</div><p>要查看其他语法使用示例，请通读：<code>Engine/Source/Developer/AutomationDriver/Private/Specs/AutomationDriver.spec.cpp</code>
</p><h4 id="by::cursor__">By::Cursor()</h4>
<p>此定位器直接返回光标当前位置下的元素。
</p><pre class="prettyprint"><code>FDriverElementRef ElementUnderCursor = Driver-&gt;FindElement(By::Cursor());</code></pre>
<h4 id="by::delegate__">By::Delegate()</h4>
<p>如果上述的现有定位器都不能满足您的要求，那么您可以通过 <code>By::Delegate()</code> 或它的各种重载来传递您自己的委托或lambda。然后，在试图定位元素时，自动化驱动程序将在Game线程上调用代码块。
</p><pre class="prettyprint"><code>FDriverElementRef CustomElement = Driver-&gt;FindElement(By::WidgetLambda(&#91;this&#93;(TArray&lt;TSharedRef&lt;SWidget&gt;&gt;&amp; OutWidgets){
    OutWidgets.Add(SpeciallyCachedWidget);
}));</code></pre>
<h3 id="执行操作">执行操作</h3>
<p>主要有两种方式来利用自动化驱动程序执行操作。当处理单个元素（或一小组元素）时，最简单的方法是直接在 <code>FDriverElementRef</code> 上使用可用操作。另一个方法是创建一个 <code>FDriverSequenceRef</code>，这样您就能够将针对许多不同元素（或者根本没有特定元素）执行的一连串操作排入队列。
</p><h4 id="元素">元素</h4>
<p>获得驱动程序元素引用后，就可以直接从它执行几个可用的操作，例如： 
</p><pre class="prettyprint"><code>Driver-&gt;FindElement(By::Id("Submit"))-&gt;Click();</code></pre>
<p>在本例中，在获得对 <code>#Submit</code> 元素的引用之后，我们直接调用默认的 <code>Click</code> 方法。驱动程序元素引用中直接可用的所有操作只影响调用它们的元素。因此，对于上面的 <code>Click</code> 示例，自动化驱动程序将首先尝试将光标移动到 <code>#Submit</code> 元素。如果Slate DOM中不存在此元素，则驱动程序将等待一段隐式配置的时间间隔，此时间间隔在自动化驱动程序配置中有定义。如果此元素在超时之前出现，则驱动程序将尝试将光标移到此元素上。如果此元素在屏幕之外，驱动程序将尝试找出一个将此元素移动到屏幕上的方法，例如将其滚动到视图中。一旦此元素进入视图，光标被移动到此元素上，然后才模拟完整的单击。 
</p><p>所有驱动程序元素引用方法都以这种方式工作，因此它们的操作仅试图影响驱动程序元素。
</p><h4 id="序列">序列</h4>
<p>驱动程序序列是为驱动程序发出操作的方法，此方法较为稳健。使用序列，您可以在不了解它可能会影响哪些元素的情况下执行操作，也可以针对一组特定元素执行操作。此外，序列还可以被多次调用，因此可重用性很高，非常适用于帮助库。 
</p><pre class="prettyprint"><code>FDriverSequenceRef Sequence = Driver-&gt;CreateSequence();
Sequence-&gt;Actions()
    .MoveToElement(By::Id("Submit"))
    .Click(EMouseButtons::Left);
Sequence-&gt;Perform();</code></pre>
<p>在未调用 <code>Perform()</code> 之前，序列不执行其操作。一旦将操作添加到序列中，就不能移除它。在执行序列时，不能向序列添加其他操作，但可以在序列完成后添加其他操作。 
</p><p>如果任何操作失败，则整个序列失败，执行将在系列的这一点停止。 
</p><h4 id="操作">操作</h4>
<p>有关可以模拟的所有操作类型的详细信息，请参阅以下文件： 
</p><ul ><li class="Default"><p><code>Engine/Source/Developer/AutomationDriver/Public/IDriverElement.h</code>
</p></li><li class="Default"><p><code>Engine/Source/Developer/AutomationDriver/Public/IDriverSequence.h</code>
</p></li></ul><p>目前，操作集合仅限于键盘和鼠标输入，通常包括： 
</p><ul ><li class="Default"><p>鼠标移动
</p></li><li class="Default"><p>鼠标滚轮滚动
</p></li><li class="Default"><p>单击
</p></li><li class="Default"><p>双击
</p></li><li class="Default"><p>按住按钮
</p></li><li class="Default"><p>释放按钮
</p></li><li class="Default"><p>键入
</p></li><li class="Default"><p>TypeChord <div class="tip">
	<p>这便于执行键盘快捷键，如Ctrl+Shift+S。</p>
</div>
</p></li><li class="Default"><p>按住按键
</p></li><li class="Default"><p>释放按键
</p></li><li class="Default"><p>对焦
</p></li></ul><p>这包括补充性智能操作，例如滚动直至某个特定元素出现在视图中，获取某个元素显示的文本、大小或位置，等等。
</p><p>虽然目前尚未积极开发，但我们计划支持以下功能：
</p><ul ><li class="Default"><p>场景/Actor交互
</p></li><li class="Default"><p>控制器输入
</p></li><li class="Default"><p>触摸输入/手势
</p></li><li class="Default"><p>运动检测
</p></li></ul><h4 id="等待">等待</h4>
<p>构建用户模拟的自动化测试时，等待各种事件的发生是很常见的，而且自动化驱动程序提供内置支持，让等待行为变得更简单。 
</p><p>对于任何依赖性场景，自动化驱动程序的所有操作都会自动等待一段配置的 <code>ImplicitWait</code> 时间间隔才执行，直至超时和操作失败。这方面的一个例子是，在为元素模拟单击事件之前，等待元素出现并可见。 
</p><p>您可以动态配置 <code>ImplicitWait</code> 时间间隔，在模拟过程中，还可以根据需要利用自动化驱动程序上的配置选项对它进行调整。例如： 
</p><p>当前默认的 <code>ImplicitWait</code> 时间间隔为3秒，您还可以执行显式或条件等待，例如： 
</p><pre class="prettyprint"><code>Driver-&gt;Wait(FTimespan::FromSeconds(2));

FDriverSequenceRef Sequence = Driver-&gt;CreateSequence();
Sequence-&gt;Actions()
    .Wait(Until::ElementExists(ElementA, FWaitTimeout::InSeconds(3)))
    .Focus(ElementA);

Driver-&gt;Wait(Until::ElementIsVisible(ElementA, FWaitInterval::InSeconds(0.25), FWaitTimeout::InSeconds(1)));

Driver-&gt;Wait(Until::ElementIsInteractable(ElementA, FWaitInterval::InSeconds(0.25), FWaitTimeout::InSeconds(1)));

Driver-&gt;Wait(Until::ElementIsScrolledToBeginning(ScrollBox, FWaitTimeout::InSeconds(3)));</code></pre>
<p>您还可以指定自己的委托或lambda条件，在继续模拟之前，这些必须成功完成。最后，每个等待都有一个必需的超时参数和一个可选的时间间隔，后者定义重新计算等待条件的频率。
</p><h2 id="结合使用">结合使用</h2>
<p>由于自动化驱动程序API不能在 <code>GameThread</code> 上执行，编写模拟可能有点困难，但是如果将自动化驱动程序与新的规范测试类型结合起来，这就变得很简单了。 
</p><p>下面是用于规范期望（测试）的120多个测试中的一个测试片段，这些测试用于确保自动化驱动程序本身正常运行。 
</p><p>请阅读<a id="content_link"filter-data="tag_automation_spec" href="../AutomationSpec/index.html" ><span>自动化规范</span></a>测试类型文档，以更好地理解下面的代码片段： 
</p><pre class="prettyprint"><code>BEGIN&#95;DEFINE&#95;SPEC(FAutomationDriverSpec, "System.Automation.Driver", EAutomationTestFlags::ProductFilter &#124; EAutomationTestFlags::ApplicationContextMask)
    TSharedPtr&lt;SWindow&gt; SuiteWindow;
    TSharedPtr&lt;SAutomationDriverSpecSuite&gt; SuiteWidget;
    TSharedPtr&lt;IAutomationDriverSpecSuiteViewModel&gt; SuiteViewModel;
    FAutomationDriverPtr Driver;
END&#95;DEFINE&#95;SPEC(FAutomationDriverSpec)
void FAutomationDriverSpec::Define()
{
    BeforeEach(&#91;this&#93;() {
        if (IAutomationDriverModule::Get().IsEnabled())
        {
            IAutomationDriverModule::Get().Disable();
        }

        IAutomationDriverModule::Get().Enable();

        if (!SuiteViewModel.IsValid())
        {
            SuiteViewModel = FSpecSuiteViewModelFactory::Create();
        }

        if (!SuiteWidget.IsValid())
        {
            SuiteWidget = SNew(SAutomationDriverSpecSuite, SuiteViewModel.ToSharedRef());
        }

        if (!SuiteWindow.IsValid())
        {
            SuiteWindow = FSlateApplication::Get().AddWindow(
                SNew(SWindow)
                .Title(FText::FromString(TEXT("Automation Driver Spec Suite")))
                .ClientSize(FVector2D(600, 540))
                &#91;
                    SuiteWidget.ToSharedRef()
                &#93;);
        }

        SuiteWidget-&gt;RestoreContents();
        SuiteWindow-&gt;BringToFront(true);
        SuiteViewModel-&gt;Reset();

        Driver = IAutomationDriverModule::Get().CreateDriver();
    });

    Describe("Element", &#91;this&#93;()
    {
        Describe("Type", &#91;this&#93;()
        {
            It("should focus the element and type the characters of the specified string", EAsyncExecution::ThreadPool, &#91;this&#93;()
            {
                FDriverElementRef Element = Driver-&gt;FindElement(By::Id("A1"));
                Element-&gt;Type(TEXT("ABCDEFGHIJKLMNOPQRSTUVWXYZ"));
                TEST&#95;EQUAL(SuiteViewModel-&gt;GetFormString(EFormElement::A1), TEXT("ABCDEFGHIJKLMNOPQRSTUVWXYZ"));
            });
        });
    });

    AfterEach(&#91;this&#93;() {
        Driver.Reset();
        IAutomationDriverModule::Get().Disable();
    });
}</code></pre>
<p>主要要点是在 <code>GameThread</code> 上执行传递给 <code>BeforeEach()</code> 的lambda，为测试设置场景，创建控件，并相应地定位窗口。<code>It()</code> lambda是实际输入模拟所发生的地方，如果仔细观察，您会发现此函数将  <code>EAsyncExecution::ThreadPool</code> 值传递给 <code>It()</code>。这导致lambda在一个与 <code>GameThread</code> 分离的线程上执行，而在 <code>GameThread</code> 上模拟输入是安全的。因此，您可以在自动化驱动程序代码中放置断点，并在执行各种操作时单步调试执行这些操作。最后，<code>AfterEach()</code> 清理环境，然后返回到 <code>GameThread</code> 上执行 <code>AfterEach()</code>。
</p><h3 id="最后提示">最后提示</h3>
<p>在处理自动化驱动程序代码时，一定要注意您不是在 <code>GameThread</code> 上操作，因此，复制非线程安全的<a id="content_link"filter-data="tag_programming" href="../../../ProgrammingAndScripting/ProgrammingWithCPP/UnrealArchitecture/SmartPointerLibrary/SharedPointer/index.html" ><span>SharedPtrs</span></a>是不安全的。这是一个重要的调用，因为Slate只使用非线程安全的 <code>SharedPtrs</code>。 
</p><p>如果您必须使用非线程安全的  <code>SharedPtr</code> 访问来某些内容，那么您应该为您的测试设置专门的 <code>BeforeEach()</code> 块，从而能够在模拟和检查行为时在线程之间进行切换。 
</p><p>如果您知道在执行测试时不会销毁  <code>SharedPtr</code>，那么另一种替代方法是，将它缓存到测试类本身，这样lambda就可以访问  <code>SharedPtr</code>，而不能复制它，因此引用计数不会导致竞争条件。我们使用上面代码片段中的  <code>SuiteViewModel</code> 来实现这一点。 
</p><p>通常，最好的做法是，在一个专门的 <code>BeforeEach()</code> 块中执行所有的自动化驱动程序模拟，然后在 <code>GameThread</code> 上在 <code>It()</code> 中执行期望检查。
</p>
																	</div>
					<!-- End of Markdown converted page content -->
				</div>
												<div id="pageTags">
				<div class="title">标签</div>
					<div>
					<div class="keyword_tag_filter"><a id="tag_link" href="../../../SiteIndex/index.html?tags=Automation%20Driver">Automation Driver</a></div>
					</div>
				</div>
								<div id="recommendations"></div>			</div>
						  									<div id="announcement">
			<div style="display:inline-block;margin:5px;">
				欢迎帮助改进虚幻引擎文档！请告诉我们该如何更好地为您服务。
			</div>
			<div style="margin:5px;display:inline-block;">
				<div class="btn action" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();window.open('https://epicgames.questionpro.com/t/AP9dGZkjp4');createCookie('announcement-read', new Date().getTime(), 30);">填写问卷调查</div>
				<div class="btn btn-default" style="margin-top:-6px;display:inline-block;" onclick="$('#announcement').hide();createCookie('announcement-read', new Date().getTime(), 30);">取消</div>
			</div>
			<div class="btn-close" style="position:absolute;right:5px;top:10px;padding:3px;width:14px;height:14px;" onclick="$('#announcement').hide();"></div>
			</div>
					</div>
	</div></body>

<!-- Mirrored from docs.unrealengine.com/4.26/zh-CN/TestingAndOptimization/Automation/AutomationDriver/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 17 Jan 2024 12:41:40 GMT -->
</html>
